"use strict";(self.webpackChunkconnect_my_set=self.webpackChunkconnect_my_set||[]).push([[184],{184(e,t,n){n.d(t,{ThreeScene:()=>y,default:()=>v});var o=n(555),r=n(950),i=n(437),s=n(61),a=n(728),c=n(615),l=n(787),d=n(903),u=n(67),p=n(414);const g={width:"100%",padding:"10px 14px",marginBottom:"12px",backgroundColor:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",color:"#ffffff",outline:"none",fontSize:"14px",lineHeight:"1.4",transition:"all 0.2s ease","&:focus":{borderColor:"rgba(46, 204, 113, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.15)"},"&::placeholder":{color:"rgba(255, 255, 255, 0.5)"}},f={padding:"10px 16px",backgroundColor:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",color:"#ffffff",cursor:"pointer",transition:"all 0.2s ease",fontSize:"14px","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.15)",borderColor:"rgba(255, 255, 255, 0.3)"}},h=e=>{let{onClose:t,recommendedType:n,spotType:i}=e;const[s,a]=(0,r.useState)({name:"",brand:"",category:"",description:"",inputs:[{type:"",position:""}],outputs:[{type:"",position:""}],scaleFactor:"",modelFile:null,additionalNotes:""});return(0,p.jsxs)("div",{className:"product-suggestion-form",style:{color:"#ffffff",padding:"20px",height:"100%",fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:[(0,p.jsx)("style",{children:'\n                    .product-suggestion-form {\n                        font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n                    }\n                    .product-suggestion-form h2,\n                    .product-suggestion-form h3,\n                    .product-suggestion-form h4 {\n                        font-family: inherit;\n                        font-style: italic;\n                    }\n                    .product-suggestion-form input,\n                    .product-suggestion-form textarea,\n                    .product-suggestion-form button {\n                        font-family: inherit;\n                    }\n                '}),(0,p.jsx)("h2",{style:{marginBottom:"20px",fontSize:"24px",fontWeight:"600",letterSpacing:"-0.5px",fontStyle:"italic"},children:"Suggest New Product"}),(0,p.jsxs)("form",{onSubmit:async e=>{var o;e.preventDefault();const r=encodeURIComponent("New Product Suggestion for LiveSet"),a=encodeURIComponent("\nProduct Information:\n-------------------\nName: ".concat(s.name,"\nBrand: ").concat(s.brand,"\nCategory: ").concat(s.category,"\nDescription: ").concat(s.description,"\n\nConnection Points:\n---------------\nInputs:\n").concat(s.inputs.map(e=>"- Type: ".concat(e.type,"\n  Position: ").concat(e.position)).join("\n"),"\n\nOutputs:\n").concat(s.outputs.map(e=>"- Type: ".concat(e.type,"\n  Position: ").concat(e.position)).join("\n"),"\n\nPlacement Preferences:\n-------------------\nRecommended Ghost Square: ").concat(n,"\nPreferred Position Type: ").concat(i,"\n\n3D Model Information:\n------------------\nScale Factor: ").concat(s.scaleFactor,"\nModel File Name: ").concat((null===(o=s.modelFile)||void 0===o?void 0:o.name)||"No file selected","\n\nAdditional Notes:\n--------------\n").concat(s.additionalNotes,"\n\nConnection Suggestions:\n-------------------\nConnection suggestions temporarily disabled\n"));window.location.href="mailto:your-email@example.com?subject=".concat(r,"&body=").concat(a),t()},style:{height:"calc(100% - 60px)",overflowY:"auto",paddingRight:"10px",scrollbarWidth:"thin",scrollbarColor:"#333333 #000000",msOverflowStyle:"none"},children:[(0,p.jsx)("style",{children:"\n                        form::-webkit-scrollbar {\n                            width: 8px;\n                            background-color: #000000;\n                        }\n                        form::-webkit-scrollbar-thumb {\n                            background-color: #333333;\n                            border-radius: 4px;\n                        }\n                        form::-webkit-scrollbar-track {\n                            background-color: #000000;\n                        }\n                    "}),(0,p.jsxs)("div",{className:"form-section",children:[(0,p.jsx)("h3",{style:{fontSize:"18px",marginBottom:"16px",fontWeight:"500",letterSpacing:"-0.3px",fontStyle:"italic"},children:"Basic Information"}),(0,p.jsx)("input",{type:"text",placeholder:"Product Name",value:s.name,onChange:e=>a((0,o.A)((0,o.A)({},s),{},{name:e.target.value})),required:!0,style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})}),(0,p.jsx)("input",{type:"text",placeholder:"Brand",value:s.brand,onChange:e=>a((0,o.A)((0,o.A)({},s),{},{brand:e.target.value})),required:!0,style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})}),(0,p.jsx)("input",{type:"text",placeholder:"Category (e.g., Player, Mixer, FX Unit)",value:s.category,onChange:e=>a((0,o.A)((0,o.A)({},s),{},{category:e.target.value})),required:!0,style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})}),(0,p.jsx)("textarea",{placeholder:"Description",value:s.description,onChange:e=>a((0,o.A)((0,o.A)({},s),{},{description:e.target.value})),required:!0,style:(0,o.A)((0,o.A)({},g),{},{height:"80px",fontFamily:"inherit"})})]}),(0,p.jsxs)("div",{className:"form-section",style:{marginTop:"24px"},children:[(0,p.jsx)("h3",{style:{fontSize:"18px",marginBottom:"16px",fontWeight:"500",letterSpacing:"-0.3px",fontStyle:"italic"},children:"Connection Points"}),(0,p.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,p.jsx)("h4",{style:{fontSize:"16px",fontWeight:"500",letterSpacing:"-0.2px",fontStyle:"italic"},children:"Inputs"}),(0,p.jsx)("button",{type:"button",onClick:()=>{a((0,o.A)((0,o.A)({},s),{},{inputs:[...s.inputs,{type:"",position:""}]}))},style:(0,o.A)((0,o.A)({},f),{},{fontFamily:"inherit"}),children:"+ Add Input"})]}),s.inputs.map((e,t)=>(0,p.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,p.jsx)("input",{type:"text",placeholder:"Input Type (e.g., Line In, Digital)",value:e.type,onChange:e=>{const n=[...s.inputs];n[t].type=e.target.value,a((0,o.A)((0,o.A)({},s),{},{inputs:n}))},style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})}),(0,p.jsx)("input",{type:"text",placeholder:"Position on Device",value:e.position,onChange:e=>{const n=[...s.inputs];n[t].position=e.target.value,a((0,o.A)((0,o.A)({},s),{},{inputs:n}))},style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})})]},t))]}),(0,p.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,p.jsx)("h4",{style:{fontSize:"16px",fontWeight:"500",letterSpacing:"-0.2px",fontStyle:"italic"},children:"Outputs"}),(0,p.jsx)("button",{type:"button",onClick:()=>{a((0,o.A)((0,o.A)({},s),{},{outputs:[...s.outputs,{type:"",position:""}]}))},style:(0,o.A)((0,o.A)({},f),{},{fontFamily:"inherit"}),children:"+ Add Output"})]}),s.outputs.map((e,t)=>(0,p.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,p.jsx)("input",{type:"text",placeholder:"Output Type (e.g., Line Out, Digital)",value:e.type,onChange:e=>{const n=[...s.outputs];n[t].type=e.target.value,a((0,o.A)((0,o.A)({},s),{},{outputs:n}))},style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})}),(0,p.jsx)("input",{type:"text",placeholder:"Position on Device",value:e.position,onChange:e=>{const n=[...s.outputs];n[t].position=e.target.value,a((0,o.A)((0,o.A)({},s),{},{outputs:n}))},style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})})]},t))]})]}),(0,p.jsxs)("div",{className:"form-section",style:{marginTop:"24px"},children:[(0,p.jsx)("h3",{style:{fontSize:"18px",marginBottom:"16px",fontWeight:"500",letterSpacing:"-0.3px",fontStyle:"italic"},children:"3D Model Information"}),(0,p.jsx)("input",{type:"text",placeholder:"Scale Factor (e.g., 0.01)",value:s.scaleFactor,onChange:e=>a((0,o.A)((0,o.A)({},s),{},{scaleFactor:e.target.value})),required:!0,style:(0,o.A)((0,o.A)({},g),{},{fontFamily:"inherit"})}),(0,p.jsx)("input",{type:"file",accept:".glb",onChange:e=>a((0,o.A)((0,o.A)({},s),{},{modelFile:e.target.files[0]})),required:!0,style:(0,o.A)((0,o.A)({},g),{},{padding:"8px",fontFamily:"inherit"})})]}),(0,p.jsxs)("div",{className:"form-section",style:{marginTop:"24px"},children:[(0,p.jsx)("h3",{style:{fontSize:"18px",marginBottom:"16px",fontWeight:"500",letterSpacing:"-0.3px",fontStyle:"italic"},children:"Additional Notes"}),(0,p.jsx)("textarea",{placeholder:"Any additional information about the product",value:s.additionalNotes,onChange:e=>a((0,o.A)((0,o.A)({},s),{},{additionalNotes:e.target.value})),style:(0,o.A)((0,o.A)({},g),{},{height:"80px",fontFamily:"inherit"})})]}),(0,p.jsxs)("div",{className:"form-section",style:{marginTop:"24px"},children:[(0,p.jsx)("h3",{style:{fontSize:"18px",marginBottom:"16px",fontWeight:"500",letterSpacing:"-0.3px",fontStyle:"italic"},children:"Connection Suggestions"}),(0,p.jsx)("div",{style:{color:"#666",fontStyle:"italic"},children:"Connection suggestions temporarily disabled"})]}),(0,p.jsxs)("div",{style:{marginTop:"24px",display:"flex",gap:"12px"},children:[(0,p.jsx)("button",{type:"submit",style:(0,o.A)((0,o.A)({},f),{},{backgroundColor:"rgba(46, 204, 113, 0.2)",border:"1px solid rgba(46, 204, 113, 0.3)",color:"#2ecc71",flex:1,fontFamily:"inherit",fontSize:"14px",fontWeight:"500"}),children:"Submit Suggestion"}),(0,p.jsx)("button",{type:"button",onClick:t,style:(0,o.A)((0,o.A)({},f),{},{backgroundColor:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",flex:1,fontFamily:"inherit",fontSize:"14px",fontWeight:"500"}),children:"Cancel"})]})]})]})},m={width:"100%",padding:"12px 16px",backgroundColor:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"#ffffff",marginBottom:"8px",cursor:"pointer",transition:"all 0.2s ease",textAlign:"left",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"space-between"},x=e=>{let{onSetView:t,onConnectionsView:n,onOpenSearch:i,placedDevicesList:s,onRemoveDevice:a,isUpdatingPaths:c,onUpdateModelPaths:l,style:d}=e;const[u,g]=(0,r.useState)(!1);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("button",{onClick:()=>g(!u),style:(0,o.A)((0,o.A)({},d),{},{background:"rgba(0, 0, 0, 0.7)",border:"none",padding:"12px",cursor:"pointer",borderRadius:"8px",backdropFilter:"blur(10px)",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}),children:[(0,p.jsx)("div",{style:{width:"24px",height:"2px",backgroundColor:"#ffffff",marginBottom:"6px",transition:"transform 0.3s ease",transform:u?"rotate(45deg) translate(6px, 6px)":"none"}}),(0,p.jsx)("div",{style:{width:"24px",height:"2px",backgroundColor:"#ffffff",marginBottom:"6px",opacity:u?0:1,transition:"opacity 0.3s ease"}}),(0,p.jsx)("div",{style:{width:"24px",height:"2px",backgroundColor:"#ffffff",transition:"transform 0.3s ease",transform:u?"rotate(-45deg) translate(6px, -6px)":"none"}})]}),(0,p.jsxs)("div",{style:{position:"fixed",top:0,right:0,width:"80%",maxWidth:"300px",height:"100vh",backgroundColor:"rgba(10, 10, 10, 0.95)",transform:u?"translateX(0)":"translateX(100%)",transition:"transform 0.3s ease",zIndex:1999,boxShadow:"-4px 0 15px rgba(0,0,0,0.3)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"column",padding:"80px 20px 20px 20px",overflowY:"auto",WebkitOverflowScrolling:"touch"},children:[(0,p.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,p.jsx)("h3",{style:{color:"#ffffff",marginBottom:"12px",fontSize:"14px",opacity:.7,letterSpacing:"1px"},children:"VIEW"}),(0,p.jsx)("button",{onClick:()=>{t(),g(!1)},style:m,children:"Set View"}),(0,p.jsx)("button",{onClick:()=>{n(),g(!1)},style:m,children:"Connections View"})]}),(0,p.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,p.jsx)("h3",{style:{color:"#ffffff",marginBottom:"12px",fontSize:"14px",opacity:.7,letterSpacing:"1px"},children:"ACTIONS"}),(0,p.jsx)("button",{onClick:()=>{i(),g(!1)},style:(0,o.A)((0,o.A)({},m),{},{backgroundColor:"rgba(0, 162, 255, 0.2)",borderColor:"rgba(0, 162, 255, 0.3)"}),children:"Add Device"}),(0,p.jsx)("button",{onClick:()=>{l(),g(!1)},disabled:c,style:m,children:"Update Model Paths"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{style:{color:"#ffffff",marginBottom:"12px",fontSize:"14px",opacity:.7,letterSpacing:"1px"},children:"CURRENT SETUP"}),(0,p.jsxs)("div",{style:{maxHeight:"40vh",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#333333 #000000",WebkitOverflowScrolling:"touch"},children:[(0,p.jsx)("style",{children:"\n                                div::-webkit-scrollbar {\n                                    width: 8px;\n                                    background-color: #000000;\n                                }\n                                div::-webkit-scrollbar-thumb {\n                                    background-color: #333333;\n                                    border-radius: 4px;\n                                }\n                                div::-webkit-scrollbar-track {\n                                    background-color: #000000;\n                                }\n                            "}),s.map(e=>(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"8px",marginBottom:"8px"},children:[(0,p.jsx)("span",{style:{color:"#ffffff",fontSize:"14px"},children:e.name}),(0,p.jsx)("button",{onClick:()=>a(e.uniqueId),style:{background:"rgba(255, 107, 107, 0.2)",border:"1px solid rgba(255, 107, 107, 0.3)",color:"#ff6b6b",cursor:"pointer",padding:"6px 12px",fontSize:"12px",borderRadius:"4px",transition:"all 0.2s ease"},children:"Remove"})]},e.uniqueId)),0===s.length&&(0,p.jsx)("div",{style:{textAlign:"center",color:"#ffffff",opacity:.5,padding:"20px 0",fontSize:"14px"},children:"No devices added yet"})]})]})]}),u&&(0,p.jsx)("div",{onClick:()=>g(!1),style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.5)",backdropFilter:"blur(4px)",zIndex:1998}})]})};function y(e){var t,n,g,f;let{devices:m,isInitialized:y,setupType:v,onDevicesChange:b,onCategoryToggle:w}=e;const C=(0,r.useRef)(null),S=(0,r.useRef)(null),z=(0,r.useRef)(null),j=(0,r.useRef)(null),I=(0,r.useRef)(null),A=(0,r.useRef)({}),D=(0,r.useRef)(m),k=(0,r.useRef)([]),P=(0,r.useRef)(null),L=(0,r.useRef)([]),F=(0,r.useRef)([]),M=(0,r.useRef)(b),R=(0,r.useRef)([]),E=(0,r.useRef)(!1),N=(0,r.useRef)(!1),[T,q]=(0,r.useState)(null),[B,J]=(0,r.useState)([]),[O,U]=(0,r.useState)(""),[W,X]=(0,r.useState)(!1),[_,H]=(0,r.useState)(""),[Y,V]=(0,r.useState)(!1),[$,G]=(0,r.useState)(null),[K,Z]=(0,r.useState)(null),[Q,ee]=(0,r.useState)(null),[te,ne]=(0,r.useState)([]),[oe,re]=(0,r.useState)(!1),[ie,se]=(0,r.useState)(null),[ae,ce]=(0,r.useState)(!1),[le,de]=(0,r.useState)([]),[ue,pe]=(0,r.useState)(!1),[ge,fe]=(0,r.useState)(v||"DJ"),[he,me]=(0,r.useState)(!1),[xe,ye]=(0,r.useState)(!1),[ve,be]=(0,r.useState)(!1),[we,Ce]=(0,r.useState)(""),[Se,ze]=(0,r.useState)(!1),[je,Ie]=(0,r.useState)(!1),[Ae,De]=(0,r.useState)(!1),[ke,Pe]=(0,r.useState)(null),[Le,Fe]=(0,r.useState)(!1),[Me,Re]=(0,r.useState)("set"),[Ee,Ne]=(0,r.useState)(0),[Te,qe]=(0,r.useState)(new Set),Be="middle",Je="middle_left",Oe="middle_right",Ue="far_left",We="far_right",Xe="fx_top",_e="fx_left",He="fx_right",Ye="speaker_left",Ve="speaker_right",$e=[{x:0,y:1.05,z:0,type:Be},{x:-.8,y:1.05,z:0,type:Je},{x:.8,y:1.05,z:0,type:Oe},{x:-1.6,y:1.05,z:0,type:Ue},{x:1.6,y:1.05,z:0,type:We},{x:-.4,y:1.05,z:0,type:"middle_left_inner"},{x:.4,y:1.05,z:0,type:"middle_right_inner"},{x:0,y:1.05,z:-.2,type:"middle_back"},{x:0,y:1.5,z:-.5,type:Xe},{x:-.4,y:1.05,z:-.3,type:_e},{x:.4,y:1.05,z:-.3,type:He},{x:0,y:1.05,z:.3,type:"fx_front"},{x:3.5,y:.05,z:-.25,type:Ye,size:{width:.4,depth:.4}},{x:-3.5,y:.05,z:-.25,type:Ve,size:{width:.4,depth:.4}}],Ge={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(10, 10, 10, 0.95)",padding:ae?"16px":"24px",borderRadius:"8px",boxShadow:"0 8px 32px rgba(0,0,0,0.4)",zIndex:1e3,width:ae?"90%":"400px",maxWidth:"500px",maxHeight:ae?"80vh":"90vh",overflowY:"auto",color:"#ffffff",border:"1px solid rgba(0, 162, 255, 0.2)",backdropFilter:"blur(12px)",scrollbarWidth:"thin",scrollbarColor:"#333333 #000000",msOverflowStyle:"none"},Ke={default:{position:{x:0,y:ae?3:2.2,z:ae?2.5:1.8},target:{x:0,y:.9,z:0}},set:{position:{x:0,y:ae?3.2:2.4,z:ae?2.8:2},target:{x:0,y:.9,z:0}},connections:{position:{x:0,y:ae?3:2.2,z:ae?-2.5:-1.8},target:{x:0,y:.9,z:0}}};function Ze(e){var t,n,r;console.log("=== updateConnections called ==="),console.log("Total devices passed:",e.length),console.log("Device names:",e.map(e=>e.name)),console.log("Full device list:",e.map(e=>{var t,n;return{name:e.name,id:e.id,uniqueId:e.uniqueId,hasInputs:!!(e.inputs&&e.inputs.length>0),hasOutputs:!!(e.outputs&&e.outputs.length>0),inputCount:(null===(t=e.inputs)||void 0===t?void 0:t.length)||0,outputCount:(null===(n=e.outputs)||void 0===n?void 0:n.length)||0}}));const s=e.find(e=>e.name.includes("DJM"));if(!s)return void console.log("\u274c No mixer found in devices");console.log("\u2705 Found mixer:",s.name),console.log("   Mixer inputs:",(null===(t=s.inputs)||void 0===t?void 0:t.map(e=>e.type))||[]),console.log("   Mixer outputs:",(null===(n=s.outputs)||void 0===n?void 0:n.map(e=>e.type))||[]);const a=e.filter(e=>e.name.includes("CDJ"));console.log("\u2705 Found ".concat(a.length," CDJ(s):"),a.map(e=>e.name)),a.forEach(e=>{var t;console.log("   ".concat(e.name," outputs:"),(null===(t=e.outputs)||void 0===t?void 0:t.map(e=>e.type))||[])});const c=e.filter(e=>{const t=e.name.toLowerCase();return t.includes("rmx")||t.includes("revolo")||t.includes("fx")||e.type&&e.type.toLowerCase().includes("fx")});console.log("\u2705 Found ".concat(c.length," FX unit(s):"),c.map(e=>e.name)),c.forEach(e=>{var t,n;console.log("   ".concat(e.name," inputs:"),(null===(t=e.inputs)||void 0===t?void 0:t.map(e=>e.type))||[]),console.log("   ".concat(e.name," outputs:"),(null===(n=e.outputs)||void 0===n?void 0:n.map(e=>e.type))||[])}),k.current.forEach(e=>{S.current.remove(e)}),k.current=[];const l=[...a].sort((e,t)=>{var n,o;return((null===(n=e.position)||void 0===n?void 0:n.x)||0)-((null===(o=t.position)||void 0===o?void 0:o.x)||0)});console.log("Sorted CDJs by position:",l.map(e=>{var t;return{name:e.name,x:null===(t=e.position)||void 0===t?void 0:t.x}}));const d=(null===(r=s.position)||void 0===r?void 0:r.x)||0;console.log("Mixer position x:",d);const u=l.filter(e=>{var t;return((null===(t=e.position)||void 0===t?void 0:t.x)||0)<d}),p=l.filter(e=>{var t;return((null===(t=e.position)||void 0===t?void 0:t.x)||0)>d});console.log("Left CDJs (x < mixer):",u.map(e=>{var t;return{name:e.name,x:null===(t=e.position)||void 0===t?void 0:t.x}})),console.log("Right CDJs (x > mixer):",p.map(e=>{var t;return{name:e.name,x:null===(t=e.position)||void 0===t?void 0:t.x}}));const g=new Map,f=l.length;1===f?(g.set(l[0].uniqueId,1),console.log("Single CDJ: ".concat(l[0].name," \u2192 LINE1"))):2===f?(g.set(l[0].uniqueId,1),g.set(l[1].uniqueId,2),console.log("Two CDJs: left \u2192 LINE1, right \u2192 LINE2")):3===f?(g.set(l[0].uniqueId,1),g.set(l[1].uniqueId,2),g.set(l[2].uniqueId,3),console.log("Three CDJs: leftmost \u2192 LINE1, middle \u2192 LINE2, rightmost \u2192 LINE3")):f>=4&&(l.length>0&&g.set(l[0].uniqueId,1),l.length>1&&g.set(l[1].uniqueId,2),l.length>2&&g.set(l[2].uniqueId,3),l.length>3&&g.set(l[3].uniqueId,4),console.log("Four+ CDJs: leftmost \u2192 LINE1, second left \u2192 LINE2, middle right \u2192 LINE3, rightmost \u2192 LINE4")),console.log("Channel assignments:",Array.from(g.entries()).map(e=>{let[t,n]=e;const o=l.find(e=>e.uniqueId===t);return"".concat((null===o||void 0===o?void 0:o.name)||t," \u2192 CH").concat(n)}));const h=new Set,m=s.inputs||[];if(l.forEach((e,t)=>{var n;let r=g.get(e.uniqueId);if(!r){r=[2,3,1,4][t%4],g.set(e.uniqueId,r),console.warn("\u26a0\ufe0f CDJ ".concat(e.name," had no assigned channel, assigning CH").concat(r," as fallback"))}console.log("Processing CDJ ".concat(t+1,"/").concat(l.length,": ").concat(e.name," at position x:").concat(null===(n=e.position)||void 0===n?void 0:n.x,", assigned to CH").concat(r));const i=(e.outputs||[]).find(e=>{const t=e.type||"";return"Line Out"===t||"RCA"===t||'1/4"'===t||t.toLowerCase().includes("line")||t.toLowerCase().includes("rca")})||(e.outputs||[])[0];if(!i)return void console.warn("\u26a0\ufe0f CDJ ".concat(e.name," has no outputs!"));let a=null,c=-1;if(r&&m.length>0){const e=m.findIndex((e,t)=>{if(h.has(t))return!1;const n=(e.type||"").toLowerCase();return n.includes("line".concat(r))||n.includes("ch".concat(r))});e>=0&&(a=m[e],c=e)}if(!a&&r>=1&&r<=4){const e=r-1;e<m.length&&!h.has(e)&&(a=m[e],c=e)}if(!a){const e=m.findIndex((e,t)=>!h.has(t));e>=0&&(a=m[e],c=e)}if(!a&&m.length>0&&(console.warn("\u26a0\ufe0f All mixer inputs used, connecting ".concat(e.name," to first input")),a=m[0],c=0),a&&c>=0&&h.add(c),!a)return void console.error("\u274c No mixer inputs available for ".concat(e.name));const d=i.coordinate||{x:.08,y:.09,z:-.32},u=(0,o.A)((0,o.A)({},d),{},{x:(d.x||0)+.44}),p=a.coordinate||{},f="number"===typeof p.x&&"number"===typeof p.y&&"number"===typeof p.z?{x:p.x,y:p.y,z:p.z}:{1:{x:-.04,y:.075,z:-.28},2:{x:-.02,y:.075,z:-.28},3:{x:.01,y:.075,z:-.28},4:{x:.04,y:.075,z:-.28}}[r]||{x:-.08,y:.075,z:-.28},x={sourcePort:(0,o.A)((0,o.A)({},i),{},{coordinate:u}),targetPort:(0,o.A)((0,o.A)({},a),{},{coordinate:f}),type:i.type||"Line Out"},y="".concat(e.uniqueId,"-").concat(s.uniqueId,"-").concat(x.sourcePort.type,"-").concat(x.targetPort.type);k.current.find(e=>e.userData&&e.userData.connectionKey===y)?console.log("\u23ed\ufe0f  Skipping duplicate connection: ".concat(e.name," to mixer")):(console.log("\u2705 Creating cable for: ".concat(e.name," \u2192 mixer (CH").concat(r||"?",", ").concat(i.type," \u2192 ").concat(a.type,")")),Qe(e,s,x))}),c.forEach(e=>{console.log("Processing FX unit: ".concat(e.name));const t=ut(s,e);var n,o;(console.log("  Found ".concat(t.length," Send connection(s) from mixer to ").concat(e.name)),0===t.length)&&(console.warn("  \u26a0\ufe0f No Send connection found from mixer to ".concat(e.name)),console.warn("     Mixer outputs:",(null===(n=s.outputs)||void 0===n?void 0:n.map(e=>e.type))||[]),console.warn("     FX unit inputs:",(null===(o=e.inputs)||void 0===o?void 0:o.map(e=>e.type))||[]));t.forEach(t=>{const n="".concat(s.uniqueId,"-").concat(e.uniqueId,"-").concat(t.sourcePort.type,"-").concat(t.targetPort.type);k.current.find(e=>e.userData&&e.userData.connectionKey===n)?console.log("  \u23ed\ufe0f  Skipping duplicate Send connection: ".concat(e.name)):(console.log("  \u2705 Creating Send cable from mixer to ".concat(e.name," (").concat(t.sourcePort.type," -> ").concat(t.targetPort.type,")")),Qe(s,e,t))});const r=ut(e,s);var i,a;(console.log("  Found ".concat(r.length," Return connection(s) from ").concat(e.name," to mixer")),0===r.length)&&(console.warn("  \u26a0\ufe0f No Return connection found from ".concat(e.name," to mixer")),console.warn("     FX unit outputs:",(null===(i=e.outputs)||void 0===i?void 0:i.map(e=>e.type))||[]),console.warn("     Mixer inputs:",(null===(a=s.inputs)||void 0===a?void 0:a.map(e=>e.type))||[]));r.forEach(t=>{const n="".concat(e.uniqueId,"-").concat(s.uniqueId,"-").concat(t.sourcePort.type,"-").concat(t.targetPort.type);k.current.find(e=>e.userData&&e.userData.connectionKey===n)?console.log("  \u23ed\ufe0f  Skipping duplicate Return connection: ".concat(e.name)):(console.log("  \u2705 Creating Return cable from ".concat(e.name," to mixer (").concat(t.sourcePort.type," -> ").concat(t.targetPort.type,")")),Qe(e,s,t))})}),s&&"DJ"===ge){const t=e.filter(e=>{const t=e.spotType||"",n=(e.name||"").toLowerCase(),o=(e.type||"").toLowerCase();return t===Ye||t===Ve||(n.includes("speaker")||n.includes("monitor")||n.includes("pa")||o.includes("speaker")||o.includes("monitor"))});if(console.log("\ud83d\udd0d Found ".concat(t.length," speaker(s) in devices:"),t.map(e=>({name:e.name,spotType:e.spotType,position:e.position}))),t.length>0){const e=(s.outputs||[]).find(e=>{const t=(e.type||"").toLowerCase();return t.includes("master")||t.includes("main")||t.includes("xlr")||t.includes("output")})||(s.outputs||[])[0];if(e){const n=(0,o.A)((0,o.A)({},e),{},{coordinate:e.coordinate||{x:.06,y:.075,z:-.28}}),r=k.current.some(e=>e.userData&&"mixer-ghost-speaker-left"===e.userData.connectionKey),a=k.current.some(e=>e.userData&&"mixer-ghost-speaker-right"===e.userData.connectionKey),c=new Set;console.log("\ud83d\udcca Processing ".concat(t.length," speaker(s) for cable assignment")),console.log("   Existing cables - Left: ".concat(r,", Right: ").concat(a)),t.forEach((e,t)=>{let o;if(console.log("  Speaker ".concat(t+1,": ").concat(e.name,", spotType: ").concat(e.spotType||"none")),e.spotType===Ye||e.spotType===Ve){if((e.spotType===Ye?r:a)||c.has(e.spotType)){o=e.spotType===Ye?Ve:Ye;(o===Ye?r:a)||c.has(o)?console.warn("    -> Both spots taken! Left cable: ".concat(r,", Right cable: ").concat(a,", Assigned:"),Array.from(c)):console.log("    -> Spot ".concat(e.spotType," unavailable, using: ").concat(o))}else o=e.spotType,console.log("    -> Using speaker's spotType: ".concat(o))}else r||c.has(Ye)?a||c.has(Ve)?c.has(Ye)?c.has(Ve)?(o=t%2===0?Ye:Ve,console.warn("    -> Both spots assigned in batch, fallback to: ".concat(o))):(o=Ve,console.log("    -> Assigning to RIGHT (not assigned in batch)")):(o=Ye,console.log("    -> Assigning to LEFT (not assigned in batch)")):(o=Ve,console.log("    -> Assigning to RIGHT (second available)")):(o=Ye,console.log("    -> Assigning to LEFT (first available)"));c.add(o),console.log("    -> Final assignment: ".concat(o,", assignedSpots:"),Array.from(c));const l=$e.find(e=>e.type===o);if(l){const t=o===Ye?"left":"right",r="mixer-ghost-speaker-".concat(t);k.current.find(e=>e.userData&&e.userData.connectionKey===r)?console.log("\u23ed\ufe0f  Cable already exists for ".concat(t," speaker")):(console.log("\u2705 Creating XLR cable from mixer master out to ".concat(t," speaker (").concat(e.name,")")),function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(!e||!t||!n)return;const s=e.position,a=n.coordinate||{x:0,y:0,z:0},c=new i.Pq0(s.x+a.x,s.y+a.y,s.z+a.z),l=new i.Pq0(t.x,t.y,t.z+.2),d=(new i.Pq0).addVectors(c,l).multiplyScalar(.5),u=.6,p=d.clone();p.z-=u;const g=c.clone().lerp(p,.5),f=l.clone().lerp(p,.5),h=new i.s0K(c,g,f,l).getPoints(50),m=(new i.LoY).setFromPoints(h),x=new i.mrM({color:o,linewidth:2}),y=new i.N1A(m,x),v=r||(t.x>0?"right":"left"),b="mixer-ghost-speaker-".concat(v);y.userData={connectionKey:b,sourceDevice:e.id,targetType:"ghost_speaker",sourcePort:n.type,cableType:"XLR"},S.current.add(y),k.current.push(y)}(s,l,n,255,t))}else console.warn("\u26a0\ufe0f Could not find speaker spot for type: ".concat(o))})}else console.warn("\u26a0\ufe0f Mixer has no master out port found for speaker cables")}else console.log("\u2139\ufe0f No speakers found in devices yet")}const x=k.current.filter(e=>{var t,n;const o=null===(t=e.material)||void 0===t||null===(n=t.color)||void 0===n?void 0:n.getHexString();return"ff0000"===o||"ff0000"===o}),y=k.current.filter(e=>{var t;return((null===(t=e.userData)||void 0===t?void 0:t.sourceDevice)||"").toLowerCase().includes("cdj")});console.log("=== Connection Summary ==="),console.log("Total cables drawn: ".concat(k.current.length)),console.log("CDJ cables (red): ".concat(x.length," out of ").concat(a.length," CDJs")),console.log("CDJ connections: ".concat(a.length," CDJs processed, ").concat(y.length," cables created")),console.log("FX unit connections: ".concat(c.length," FX units processed")),a.length>y.length&&(console.error("\u274c ERROR: Missing ".concat(a.length-y.length," CDJ cable(s)!")),console.error("   Expected: ".concat(a.length,", Got: ").concat(y.length))),console.log("Cable types:",k.current.map(e=>{var t,n,o,r;return{from:null===(t=e.userData)||void 0===t?void 0:t.sourceDevice,to:null===(n=e.userData)||void 0===n?void 0:n.targetDevice,type:(null===(o=e.userData)||void 0===o?void 0:o.connectionType)||(null===(r=e.userData)||void 0===r?void 0:r.sourcePort),color:e.material.color.getHexString()}})),console.log("========================"),I.current&&S.current&&z.current&&I.current.render(S.current,z.current)}function Qe(e,t,n){var o,r;if(!e||!t||!n)return;const s=e.position,a=t.position,c=e=>e?void 0!==e.x&&void 0!==e.y&&void 0!==e.z?{x:e.x,y:e.y,z:e.z}:"object"===typeof e?{x:e.x||0,y:e.y||0,z:e.z||0}:{x:0,y:0,z:0}:{x:0,y:0,z:0},l=c(n.sourcePort.coordinate),d=c(n.targetPort.coordinate),u=new i.Pq0(s.x+l.x,s.y+l.y,s.z+l.z),p=new i.Pq0(a.x+d.x,a.y+d.y,a.z+d.z);console.log("Drawing cable from ".concat(e.name," to ").concat(t.name)),console.log("  Source device pos:",s),console.log("  Source port coord:",l),console.log("  Start point:",u),console.log("  Target device pos:",a),console.log("  Target port coord:",d),console.log("  End point:",p);const g=(new i.Pq0).addVectors(u,p).multiplyScalar(.5);let f=null,h=0;const m=n.targetPort.type&&n.targetPort.type.startsWith("Line");m&&(f=parseInt(n.targetPort.type.replace("Line","")),h=.08*(f-2.5));const x=g.clone();x.z-=.6+h;const y=u.clone().lerp(x,.5),v=p.clone().lerp(x,.5),b=new i.s0K(u,y,v,p).getPoints(50),w=(new i.LoY).setFromPoints(b);let C;C=m&&f?it["Line".concat(f)]||it.Default:"Send"===n.type||null!==(o=n.sourcePort.type)&&void 0!==o&&o.toLowerCase().includes("send")?16737792:"Return"===n.type||null!==(r=n.sourcePort.type)&&void 0!==r&&r.toLowerCase().includes("return")?65382:it.Default;const z=new i.mrM({color:C}),j=new i.N1A(w,z),I="".concat(e.uniqueId,"-").concat(t.uniqueId,"-").concat(n.sourcePort.type,"-").concat(n.targetPort.type);j.userData={connectionKey:I,sourceDevice:e.id,targetDevice:t.id,sourcePort:n.sourcePort.type,targetPort:n.targetPort.type,connectionType:n.type},S.current.add(j),k.current.push(j)}const et=e=>{if("DJ"!==ge)return!1;console.log("Checking basic setup with devices:",e.map(e=>e.name));const t=e.filter(e=>{const t=e.name.toLowerCase();return t.includes("cdj")||t.includes("player")}).length,n=e.some(e=>{const t=e.name.toLowerCase();return t.includes("djm")||t.includes("mixer")}),o=t>=2&&n;return console.log("Basic setup check results:",{playerCount:t,hasMixer:n,isComplete:o,devices:e.map(e=>e.name)}),o};(0,r.useEffect)(()=>{M.current=b},[b]),(0,r.useEffect)(()=>{if(le.length>0){console.log("Device list changed, current state:",{devices:le.map(e=>e.name),currentBasicSetupComplete:ue});const e=et(le);console.log("Basic setup is ".concat(e?"complete":"not complete")),e!==ue&&(console.log("Basic setup state changed from ".concat(ue," to ").concat(e,", updating ghost spots...")),pe(e),setTimeout(()=>{S.current&&(L.current.forEach(e=>{e&&e.parent&&S.current.remove(e)}),L.current=[],console.log("Recreating ghost spots with basic setup =",e),xt(S.current,e),I.current&&z.current&&I.current.render(S.current,z.current))},0))}R.current=le,S.current&&le.length>0&&(console.log("Updating connections due to placedDevicesList change"),Ze(le)),M.current&&M.current(le)},[le,ue]);const tt=async(e,t)=>{var n;const r=null===(n=L.current[t])||void 0===n?void 0:n.position;if(r)try{console.log("Loading 3D model for ".concat(e.name," at position:"),r);let n=e.modelPath||e.modelUrl;const d=n&&!n.startsWith("http")&&!n.startsWith("gs://"),p=e.name&&(e.name.includes("CDJ-3000")||e.name.includes("CDJ3000"));if(!n||p&&(d||n&&n.includes("localhost"))){const t=await(0,u.yb)("".concat(e.name,".glb"));t?n=t:p&&(n=null)}if(!n||n.startsWith("http")||n.startsWith("gs://")||(n=n.startsWith("/")?"".concat(window.location.origin).concat(n):"".concat(window.location.origin,"/").concat(n)),console.log("Using model URL:",n),!n){var a,c,l;console.warn("No model URL for",e.name,"- adding placeholder");const n=(0,o.A)((0,o.A)({},e),{},{id:e.id,position:{x:r.x,y:r.y,z:r.z},inputs:e.inputs||[],outputs:e.outputs||[],uniqueId:"".concat(e.id,"-").concat(r.x,"-").concat(r.y,"-").concat(r.z),modelPath:null,spotType:null!==(a=null===(c=L.current[t])||void 0===c||null===(l=c.userData)||void 0===l?void 0:l.type)&&void 0!==a?a:null,placementIndex:t}),s=S.current;if(s){const t=new i.iNn(.25,.25,.25),o=new i.V9B({color:4473924}),a=new i.eaF(t,o);a.position.set(r.x,r.y,r.z),s.add(a),a.userData={productId:e.id,name:e.name,position:n.position,uniqueId:n.uniqueId},A.current[n.uniqueId]={model:a,data:n};const c=F.current.findIndex(e=>e.uniqueId===n.uniqueId);-1!==c?F.current[c]=n:F.current.push(n),St(n,"add"),I.current&&z.current&&I.current.render(s,z.current)}return}return new Promise(i=>{(new s.B).load(n,s=>{var a,c,l;console.log("Model loaded successfully:",e.name);const d=s.scene;(e.name.includes("RMX-1000")||e.name.includes("RMX1000"))&&(console.log("Scaling down RMX-1000 model"),d.scale.set(.01,.01,.01)),d.position.set(r.x,r.y,r.z);const u=null!==(a=null===(c=L.current[t])||void 0===c||null===(l=c.userData)||void 0===l?void 0:l.type)&&void 0!==a?a:null,p=(0,o.A)((0,o.A)({},e),{},{id:e.id,position:{x:r.x,y:r.y,z:r.z},inputs:e.inputs||[],outputs:e.outputs||[],uniqueId:"".concat(e.id,"-").concat(r.x,"-").concat(r.y,"-").concat(r.z),modelPath:n,spotType:u,placementIndex:t});d.userData={productId:e.id,name:e.name,position:p.position,inputs:p.inputs,outputs:p.outputs,uniqueId:p.uniqueId},S.current.add(d),A.current[p.uniqueId]={model:d,data:p};const g=F.current.findIndex(e=>e.uniqueId===p.uniqueId);-1!==g?F.current[g]=p:F.current.push(p),console.log("Added ".concat(e.name," at position:"),p.position),St(p,"add"),I.current&&S.current&&z.current&&I.current.render(S.current,z.current),i()},e=>{const t=e.loaded/e.total*100;console.log("Loading progress: ".concat(t.toFixed(2),"%"))},t=>{console.error("Error loading model:",t),console.error("Failed model URL:",n),alert("Failed to load 3D model for ".concat(e.name,". Please check the console for details.")),i()})})}catch(ie){console.error("Error processing model:",ie),console.error("Product data:",e),alert("Failed to process model for ".concat(e.name,". Please check the console for details."))}else console.error("Invalid position index:",t)},nt=async()=>{try{if(console.log("Starting to fetch products from Firestore..."),l.j2.currentUser&&console.log("Authenticated as:",l.j2.currentUser.email),!l.db)return void console.error("Firebase database not initialized");const e=(0,c.rJ)(l.db,"products"),t=await(0,c.GG)(e);if(t.empty)return void console.log("No products found in database");const n=[];t.forEach(e=>{const t=e.data();console.log("Found product in Firestore:",t.name),console.log("Full product data:",JSON.stringify(t,null,2)),n.push((0,o.A)({id:e.id},t))}),console.log("Found ".concat(n.length," products in Firestore:"),n),J(n),ne(n),se(null)}catch(ie){console.error("Error fetching products:",ie),se("Failed to fetch products. Please try again.")}},ot=(e,t)=>{var n,o;if(!t||!e)return!1;const r=(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||"",i=(null===(o=e.category)||void 0===o?void 0:o.toLowerCase())||"";switch(t){case"Player (CDJ)":return r.includes("cdj")||r.includes("player")||i.includes("player");case"Mixer (DJM)":return r.includes("djm")||r.includes("mixer")||i.includes("mixer");case"RMX-1000":return r.includes("rmx")||"rmx-1000"===r||i.includes("fx")&&r.includes("1000");default:return!1}},rt=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{console.log("Opening search with mode: ".concat(e,", ghostIndex: ").concat(t)),H(e),q(t),X(!0),U(""),ne([]),await nt()}catch(ie){console.error("Error in openSearch:",ie),alert("Failed to open search. Please try again.")}};const it={Line1:16711680,Line2:16724787,Line3:13369344,Line4:16737894,Default:16711680};function st(e,t,n,o){let r={x:1,y:1,z:2};if(e.modelPath){let s=e.modelPath;s.startsWith("http")||s.startsWith("gs://")||(s=s.startsWith("/")?"".concat(window.location.origin).concat(s):"".concat(window.location.origin,"/").concat(s)),console.log("Loading model from URL:",s,t),n.load(s,n=>{console.log("GLTF loaded successfully:",e.name,t);const s=n.scene,a=(new i.NRn).setFromObject(s),c=new i.Pq0;a.getSize(c),console.log("Model dimensions(width, height, depth): ".concat(c.x,", ").concat(c.y,", ").concat(c.z)),r=lt(e,t,c),console.log("loadDevice position setting: ".concat(r.x,", ").concat(r.y,", ").concat(r.z)),s.position.set(r.x,r.y,r.z);const l=a.getCenter(new i.Pq0);s.position.sub(l),o.add(s),A.current[e.id]={model:s,data:e,connectionsInUse:{inputs:[],outputs:[]}};s.scale.set(1,1,1),s.traverse(e=>{e.isMesh&&(console.log("Mesh geometry:",e.geometry),e.material.side=i.$EB,e.castShadow=!0,e.receiveShadow=!0)})},e=>{console.log("Loading progress: ".concat(e.loaded/e.total*100,"%"))},t=>{console.error("Error loading model:",e.name,t),dt(e,r,o)})}else console.log("No model URL for device:",e.name),dt(e,r,o)}(0,r.useEffect)(()=>{console.log("Devices prop updated:",m),m.forEach((e,t)=>{console.log("Device ".concat(t,":"),e.name,"ID:",e.id)})},[m]),(0,r.useEffect)(()=>{if(!C.current)return;let e=!1;const t=async()=>{try{if(console.log("Initializing ThreeScene..."),null===l.j2||void 0===l.j2||!l.j2.currentUser)return void console.log("Waiting for authentication...");if(e)return;e=!0;const n=C.current.clientWidth,o=C.current.clientHeight,r=new i.Z58,s=new i.ubm(75,n/o,.1,1e3),c=new i.JeP({antialias:!0});S.current=r,z.current=s,I.current=c,r.background=new i.Q1f(15790320),c.setSize(n,o),c.shadowMap.enabled=!0,C.current.appendChild(c.domElement);const d=new i.$p8(4210752,.5);r.add(d);const u=new i.ZyN(16777215,1);u.position.set(5,5,5),r.add(u);const p=new i.dth(16777147,526368,1);r.add(p),s.position.set(Ke.default.position.x,Ke.default.position.y,Ke.default.position.z);const g=new a.N(s,c.domElement);j.current=g,g.enableDamping=!0,g.dampingFactor=.05,g.mouseButtons.LEFT=2,g.mouseButtons.RIGHT=null,g.enableZoom=!0,g.zoomSpeed=1.2,g.minDistance=1,g.maxDistance=25,g.touches={ONE:i.wtR.ROTATE,TWO:-1};const f=new Map;let h=0,m=0;const x=1,y=25;function v(e){const t=Array.from(e.values());if(t.length<2)return 0;const n=t[0],o=t[1];return Math.hypot(n.clientX-o.clientX,n.clientY-o.clientY)}function b(e){f.set(e.pointerId,{clientX:e.clientX,clientY:e.clientY}),2===f.size&&(N.current=!0,h=v(f),m=s.position.distanceTo(g.target))}function w(e){if(f.has(e.pointerId)&&(f.set(e.pointerId,{clientX:e.clientX,clientY:e.clientY}),2===f.size&&h>0)){e.preventDefault(),e.stopImmediatePropagation();const t=v(f);if(t<=0)return;let n=m*(h/t);n=Math.max(x,Math.min(y,n));const o=s.position.clone().sub(g.target).normalize();s.position.copy(g.target).add(o.multiplyScalar(n)),g.update()}}function D(e){f.delete(e.pointerId),f.size<2&&(h=0,setTimeout(()=>{N.current=!1},150))}const k=c.domElement,P=!0;k.addEventListener("pointerdown",b,{capture:P}),k.addEventListener("pointermove",w,{capture:P}),k.addEventListener("pointerup",D,{capture:P}),k.addEventListener("pointercancel",D,{capture:P});const F=e=>{e.preventDefault(),e.stopImmediatePropagation();const t=void 0!==e.deltaY?e.deltaY:e.wheelDeltaY?-e.wheelDeltaY/120:0,n=void 0!==e.deltaX?e.deltaX:e.wheelDeltaX?-e.wheelDeltaX/120:0;if(e.ctrlKey){const e=s.position.distanceTo(g.target),n=.002,o=Math.max(x,Math.min(y,e+t*n*e)),r=s.position.clone().sub(g.target).normalize();s.position.copy(g.target).add(r.multiplyScalar(o))}else{const e=.002,o=new i.YHV,r=s.position.clone().sub(g.target);o.setFromVector3(r),0!==n&&(o.theta+=n*e,o.theta=(o.theta%(2*Math.PI)+2*Math.PI)%(2*Math.PI)),0!==t&&(o.phi+=t*e,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)));const a=new i.Pq0;a.setFromSpherical(o),a.add(g.target),s.position.copy(a)}g.update()};c.domElement.addEventListener("wheel",F,{passive:!1,capture:!0}),g.target.set(Ke.default.target.x,Ke.default.target.y,Ke.default.target.z);const M=new i.YHV,E=s.position.clone().sub(g.target);M.setFromVector3(E),M.theta=(M.theta%(2*Math.PI)+2*Math.PI)%(2*Math.PI);const T=new i.Pq0;T.setFromSpherical(M),T.add(g.target),s.position.copy(T),g.update(),pt(r),xt(r);const q=function(){var e;const t=new i.tBo,n=new i.I9Y;let o=null;function r(e){var r;if(null===(r=I.current)||void 0===r||!r.domElement)return;if(e.touches&&e.touches.length>=2)return;const i=I.current.domElement.getBoundingClientRect(),s=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY;if(n.x=(s-i.left)/i.width*2-1,n.y=-(a-i.top)/i.height*2+1,t.setFromCamera(n,z.current),!Y){const n=Object.values(A.current).map(e=>e.model).filter(Boolean);if(n.length>0){const o=t.intersectObjects(n,!0);if(o.length>0){var c,l;let t=o[0].object;for(;t&&(null===(d=t.userData)||void 0===d||!d.uniqueId);){var d;t=t.parent}const n=null===(c=t)||void 0===c||null===(l=c.userData)||void 0===l?void 0:l.uniqueId;if(n){const t=A.current[n];if(null!==t&&void 0!==t&&t.data&&("click"===e.type||"touchend"===e.type&&!N.current))return X(!1),H(""),Pe(t.data),De(!0),void Fe(!1)}}}}const u=t.intersectObjects(L.current);if(o&&(o.material.color.setHex(o.userData.defaultColor),o.material.opacity=.4),u.length>0){if(o=u[0].object,o.material.color.setHex(o.userData.hoverColor),o.material.opacity=.6,"click"===e.type||"touchend"===e.type&&!N.current){!function(e){const t=R.current||le,n=L.current[e],o=t.find(t=>t.placementIndex===e)||(null===n||void 0===n?void 0:n.position)&&t.find(e=>{var t,o;const r=e.position;if(!r||"number"!==typeof r.x)return!1;const i=r.x-n.position.x,s=(null!==(t=r.z)&&void 0!==t?t:0)-(null!==(o=n.position.z)&&void 0!==o?o:0);return Math.abs(i)<.05&&Math.abs(s)<.05});if(o)return X(!1),H(""),Pe(o),De(!0),void Fe(!1);rt("ghost",e)}(u[0].object.userData.index)}}else o=null}const s=null===(e=I.current)||void 0===e?void 0:e.domElement;s&&(s.addEventListener("touchstart",r,{passive:!1}),s.addEventListener("touchmove",r,{passive:!1}),s.addEventListener("touchend",r,{passive:!1}),s.addEventListener("mousemove",r),s.addEventListener("click",r));return()=>{s&&(s.removeEventListener("touchstart",r),s.removeEventListener("touchmove",r),s.removeEventListener("touchend",r),s.removeEventListener("mousemove",r),s.removeEventListener("click",r))}}();re(!0);const B=()=>{requestAnimationFrame(B),g.update(),c.render(r,s)};B();const J=()=>{if(!C.current)return;const e=C.current.clientWidth,t=C.current.clientHeight;s.aspect=e/t,s.updateProjectionMatrix(),c.setSize(e,t)};return window.addEventListener("resize",J),()=>{window.removeEventListener("resize",J),c.domElement.removeEventListener("wheel",F,{capture:!0}),k.removeEventListener("pointerdown",b,{capture:!0}),k.removeEventListener("pointermove",w,{capture:!0}),k.removeEventListener("pointerup",D,{capture:!0}),k.removeEventListener("pointercancel",D,{capture:!0}),q&&q()}}catch(t){console.error("Error initializing Three.js scene:",t),se("Failed to initialize 3D scene. Please refresh the page.")}},n=l.j2.onAuthStateChanged(e=>{e?t():se("Please sign in to access the application")});return()=>{var e;n();const t=C.current;t&&null!==(e=I.current)&&void 0!==e&&e.domElement&&t.removeChild(I.current.domElement),S.current&&S.current.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),I.current&&I.current.dispose()}},[]),(0,r.useEffect)(()=>{var e;if(!oe||!S.current||!z.current||!j.current)return;if(!m||0===m.length)return D.current=[],void(E.current=!1);const t=S.current,n=new s.B,r=D.current,a=[...m].sort((e,t)=>{var n,o;return(null!==(n=e.locationPriority)&&void 0!==n?n:0)-(null!==(o=t.locationPriority)&&void 0!==o?o:0)}),c=r.length!==m.length||r.some((e,t)=>{var n;return e.id!==(null===(n=m[t])||void 0===n?void 0:n.id)}),l=a.length>0&&(null===(e=L.current)||void 0===e?void 0:e.length)>0&&(!E.current||c),d=new Set(m.map(e=>e.uniqueId).filter(Boolean));if(r.forEach(e=>{if(!e.uniqueId||d.has(e.uniqueId))return;const n=A.current[e.uniqueId];null!==n&&void 0!==n&&n.model&&(t.remove(n.model),delete A.current[e.uniqueId])}),l){E.current=!0,F.current=[],de([]);const e=et(a);xt(t,e),e&&pe(!0);const n=e=>{if(!e||"number"!==typeof e.x)return-1;let t=-1,n=1/0;return L.current.forEach((o,r)=>{if(null===o||void 0===o||!o.position)return;const i=o.position.x-e.x,s=(o.position.y||0)-(e.y||0),a=(o.position.z||0)-(e.z||0),c=i*i+s*s+a*a;c<n&&(n=c,t=r)}),t},r=new Set;(async()=>{for(let t=0;t<a.length;t++){var e;const i=a[t];let s=i.placementIndex;if(null==s&&null!=i.spotType){const e=L.current.findIndex((e,t)=>{var n;return(null===e||void 0===e||null===(n=e.userData)||void 0===n?void 0:n.type)===i.spotType&&!r.has(t)});e>=0&&(s=e)}for(null==s&&i.position&&"number"===typeof i.position.x&&(s=n(i.position)),null==s&&(s=t);r.has(s)&&s<L.current.length-1;)s++;if(r.add(s),s=Math.min(s,L.current.length-1),s<0)continue;const c=L.current[s];if(null===c||void 0===c||!c.position)continue;const l=c.position,d="".concat(i.id,"-").concat(l.x,"-").concat(l.y,"-").concat(l.z);if(null!==(e=A.current[d])&&void 0!==e&&e.model)continue;let u=(0,o.A)({},i);if(!u.modelPath||!u.modelPath.startsWith("http")&&!u.modelPath.startsWith("gs://")){const e=await at(u.name);e&&(u=(0,o.A)((0,o.A)({},u),{},{modelPath:e}))}u.modelPath&&await tt(u,s)}[500,1e3,1500,2e3,2500].forEach(e=>{setTimeout(()=>{const e=R.current||[];S.current&&e.length>0&&(Ze(e),I.current&&z.current&&I.current.render(S.current,z.current))},e)})})()}else a.forEach((e,o)=>{const r=e.uniqueId?A.current[e.uniqueId]:A.current[e.id];if(null!==r&&void 0!==r&&r.model){const t=r.model,n=lt(e,o,(new i.NRn).setFromObject(t).getSize(new i.Pq0));t.position.set(n.x,n.y,n.z)}else ct(e,o,n,t)}),Ze(m);D.current=m},[m,oe]);const at=async e=>{try{return await(0,u.yb)("".concat(e,".glb"))}catch(ie){return console.error("Error getting Firebase model URL for:",e,ie),null}},ct=async(e,t,n,r)=>{let i={x:1,y:1,z:2};if(e.modelPath&&(e.modelPath.startsWith("https://")||e.modelPath.startsWith("gs://")))return void st(e,t,n,r);console.log("Attempting to get Firebase Storage URL for:",e.name);const s=await at(e.name);if(s){console.log("Found Firebase Storage URL for",e.name,":",s);st((0,o.A)((0,o.A)({},e),{},{modelPath:s}),t,n,r)}else console.log("No Firebase Storage URL found for:",e.name,"- using placeholder"),dt(e,i,r)};function lt(e,t,n){var o;let r={x:1,y:1,z:2};if(!P.current)return console.log("getDevicePosition No table ref object set "),r;if(null==e)return console.log("getDevicePosition No device or model ref object set "),r;if(e.spotType&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z){var i;console.log("Using smart placement for ".concat(e.name," at spot: ").concat(e.spotType));const t=P.current.position.clone(),o=(null===(i=P.current.geometry.parameters)||void 0===i?void 0:i.height)||.02,s=n.y;return r={x:e.x,y:t.y+o/2+s/2,z:e.z},console.log("Smart placement for ".concat(e.name,": x:").concat(r.x,", y:").concat(r.y,", z:").concat(r.z)),r}const s=P.current.position.clone(),a=(null===(o=P.current.geometry.parameters)||void 0===o?void 0:o.height)||.02,c=n.y;console.log("Looking for location: "+e.name),console.log("finding location for Device ".concat(t,":"),e.name,"ID:",e.id);const l=t%2===0?-1:1,d=0===t?0:Math.floor((t-1)/2)+1;return r={x:s.x/2+l*d*.75,y:s.y+a/2+c/2,z:s.z},console.log("Setting location for ".concat(e.name,".x:").concat(r.x,", y:").concat(r.y,", z:").concat(r.z)),r}function dt(e,t,n){console.log("Creating placeholder for:",e.name);const o=new i.iNn(.25,.25,.25),r=new i.V9B({color:3355443}),s=new i.eaF(o,r),a=t&&"number"===typeof t.x?t:{x:0,y:1.05,z:0};s.position.set(a.x,a.y,a.z),n.add(s),A.current[e.id]={model:s,data:e,connectionsInUse:{inputs:[],outputs:[]}}}function ut(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!e||!t)return[];const i=[],s=e.outputs||[],a=t.inputs||[];console.log("Checking connections between:",e.name,"and",t.name),console.log("Source device position:",e.position),console.log("Source outputs:",s.map(e=>e.type)),console.log("Target inputs:",a.map(e=>e.type)),console.log("Used inputs:",Array.from(n)),console.log("Assigned channel:",r?"CH".concat(r):"none");const c=e.name.includes("DJM"),l=t.name.toLowerCase().includes("rmx")||t.name.toLowerCase().includes("revolo")||t.name.toLowerCase().includes("fx")||t.type&&t.type.toLowerCase().includes("fx");if(c&&l){var d,u;console.log("Processing mixer to FX unit connection (Send)"),console.log("Mixer outputs available:",s.map(e=>e.type)),console.log("FX unit inputs available:",a.map(e=>e.type));const e=e=>e.type&&("Send"===e.type||"Send Out"===e.type||e.type.toLowerCase().includes("send")),t=e=>e.type&&("Send"===e.type||"Send In"===e.type||e.type.toLowerCase().includes("send"));let n=s.find(e),r=a.find(t);var p,g;if(!n&&s.length>0)n=s.find(e=>{var t,n,o;return!(null!==(t=e.type)&&void 0!==t&&t.toLowerCase().includes("line"))&&!(null!==(n=e.type)&&void 0!==n&&n.toLowerCase().includes("rca"))&&!(null!==(o=e.type)&&void 0!==o&&o.toLowerCase().includes("1/4"))})||s[0],console.log("\u26a0\ufe0f No Send/Send Out port found, using fallback:",null===(p=n)||void 0===p?void 0:p.type);if(!r&&a.length>0)r=a.find(e=>{var t,n,o;return!(null!==(t=e.type)&&void 0!==t&&t.toLowerCase().includes("line"))&&!(null!==(n=e.type)&&void 0!==n&&n.toLowerCase().includes("rca"))&&!(null!==(o=e.type)&&void 0!==o&&o.toLowerCase().includes("1/4"))})||a[0],console.log("\u26a0\ufe0f No Send/Send In port found, using fallback:",null===(g=r)||void 0===g?void 0:g.type);if(console.log("Using Send Output:",null===(d=n)||void 0===d?void 0:d.type),console.log("Using Send Input:",null===(u=r)||void 0===u?void 0:u.type),n&&r){const e=e=>e&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z?{x:Number(e.x),y:Number(e.y),z:Number(e.z)}:null,t=e(n.coordinate)||{x:.02,y:.075,z:-.28},s=e(r.coordinate)||{x:.06,y:.075,z:-.28};i.push({sourcePort:(0,o.A)((0,o.A)({},n),{},{coordinate:t}),targetPort:(0,o.A)((0,o.A)({},r),{},{coordinate:s}),type:"Send"}),console.log("\u2705 Connected mixer to FX unit (Send)"),console.log("   Send Out coord (mixer):",t),console.log("   Send In coord (FX/Revolo):",s)}else console.warn("\u274c Cannot connect: No available ports"),n||console.warn("  - Mixer has no Send/Send Out"),r||console.warn("  - FX unit has no Send/Send In")}const f=e.name.toLowerCase().includes("rmx")||e.name.toLowerCase().includes("revolo")||e.name.toLowerCase().includes("fx")||e.type&&e.type.toLowerCase().includes("fx"),h=t.name.includes("DJM");if(f&&h){var m,x;console.log("Processing FX unit to mixer connection (Return)"),console.log("FX unit outputs available:",s.map(e=>e.type)),console.log("Mixer inputs available:",a.map(e=>e.type));const e=e=>{if(!e.type)return!1;const t=e.type.toLowerCase();return"return"===t||"return out"===t||t.includes("return")&&(t.includes("out")||!t.includes("in"))},t=e=>{if(!e.type)return!1;const t=e.type.toLowerCase();return"return"===t||"return in"===t||t.includes("return")&&(t.includes("in")||!t.includes("out"))};let n=s.find(e),r=a.find(t);var y,v;if(!n&&s.length>0)n=s.find(e=>{var t;return!(null!==(t=e.type)&&void 0!==t&&t.toLowerCase().includes("send"))})||s[0],console.log("\u26a0\ufe0f No Return/Return Out port found, using fallback:",null===(y=n)||void 0===y?void 0:y.type);if(!r&&a.length>0)r=a.find(e=>{var t,n,o;return!(null!==(t=e.type)&&void 0!==t&&t.toLowerCase().includes("line"))&&!(null!==(n=e.type)&&void 0!==n&&n.toLowerCase().includes("rca"))&&!(null!==(o=e.type)&&void 0!==o&&o.toLowerCase().includes("1/4"))})||a[0],console.log("\u26a0\ufe0f No Return/Return In port found, using fallback:",null===(v=r)||void 0===v?void 0:v.type);if(console.log("Using Return Output (FX/Revolo):",null===(m=n)||void 0===m?void 0:m.type),console.log("Using Return Input (mixer):",null===(x=r)||void 0===x?void 0:x.type),n&&r){const e=e=>e&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z?{x:Number(e.x),y:Number(e.y),z:Number(e.z)}:null,t=e(n.coordinate)||{x:.06,y:.075,z:-.28},s=e(r.coordinate)||{x:.02,y:.075,z:-.28};i.push({sourcePort:(0,o.A)((0,o.A)({},n),{},{coordinate:t}),targetPort:(0,o.A)((0,o.A)({},r),{},{coordinate:s}),type:"Return"}),console.log("\u2705 Connected FX unit to mixer (Return)"),console.log("   Return Out coord (FX/Revolo):",t),console.log("   Return In coord (mixer):",s)}else console.warn("\u274c Cannot connect: No available ports"),n||console.warn("  - FX unit has no Return/Return Out"),r||console.warn("  - Mixer has no Return/Return In")}if(e.name.includes("CDJ")&&t.name.includes("DJM")){const t=r;var b,w,C;if(t)console.log('CDJ "'.concat(e.name,'" assigned to CH').concat(t," (Line").concat(t,")"));else console.warn('\u26a0\ufe0f CDJ "'.concat(e.name,'" has no assigned channel - this should not happen!')),console.warn("   CDJ position: x:".concat(null===(b=e.position)||void 0===b?void 0:b.x,", y:").concat(null===(w=e.position)||void 0===w?void 0:w.y,", z:").concat(null===(C=e.position)||void 0===C?void 0:C.z));s.forEach(r=>{var s,c,l;if("Line Out"===r.type||"RCA"===r.type||'1/4"'===r.type||(null===(s=r.type)||void 0===s?void 0:s.toLowerCase().includes("line"))&&(null===(c=r.type)||void 0===c?void 0:c.toLowerCase().includes("out"))||(null===(l=r.type)||void 0===l?void 0:l.toLowerCase().includes("rca"))){let s=null;if(!t)return void console.warn('\u26a0\ufe0f CDJ "'.concat(e.name,'" has no assigned channel - skipping connection'));if(s=a.find(e=>{if(n.has(e.type))return!1;const o=e.type||"",r=o.toLowerCase();return r.includes("line".concat(t))||r.includes("ch".concat(t))||r.includes("line ".concat(t))||r.includes("ch ".concat(t))||o==="Line".concat(t)||o==="CH".concat(t)}),!s){const e=1===t?.085:2===t?-.04:3===t?.005:4===t?-.12:0;s=a.find(t=>{var o;if(n.has(t.type))return!1;if(!("RCA"===t.type||'1/4"'===t.type||(null===(o=t.type)||void 0===o?void 0:o.toLowerCase().includes("rca"))))return!1;const r=(t.coordinate||{}).x||0;return Math.abs(r-e)<.1})}if(s||(s=a.find(e=>{var t,o,r;if(n.has(e.type))return!1;const i="RCA"===e.type||'1/4"'===e.type||(null===(t=e.type)||void 0===t?void 0:t.toLowerCase().includes("rca")),s=(null===(o=e.type)||void 0===o?void 0:o.toLowerCase().includes("line"))&&(null===(r=e.type)||void 0===r?void 0:r.toLowerCase().includes("in"));return i||s})),s||(s=a.find(e=>!n.has(e.type))),s){if(n.has(s.type))return void console.log("\u23ed\ufe0f  Skipping ".concat(s.type," - already in use"));const e=r.coordinate||{},a=s.coordinate||{},c=e&&(void 0!==e.x||null!==e.x)&&(void 0!==e.y||null!==e.y)&&(void 0!==e.z||null!==e.z),l=a&&(void 0!==a.x||null!==a.x)&&(void 0!==a.y||null!==a.y)&&(void 0!==a.z||null!==a.z),d=c?e:{x:3===t?.06:.08,y:.09,z:-.32},u=l?a:(()=>{switch(t){case 1:return{x:-.12,y:.075,z:-.28};case 2:return{x:-.04,y:.075,z:-.28};case 3:return{x:.005,y:.075,z:-.28};case 4:return{x:.085,y:.075,z:-.28};default:return{x:.08*(t-2.5),y:.075,z:-.28}}})();i.push({sourcePort:(0,o.A)((0,o.A)({},r),{},{coordinate:d}),targetPort:(0,o.A)((0,o.A)({},s),{},{coordinate:u}),type:r.type}),console.log("\u2705 Connected CDJ ".concat(r.type," to Mixer ").concat(s.type," (Line").concat(t,")")),console.log("   Using ".concat(c?"actual":"default"," output coord:"),d),console.log("   Using ".concat(l?"actual":"default"," input coord:"),u)}else console.warn('\u26a0\ufe0f No matching input found for CDJ output "'.concat(r.type,'"')),console.warn("   Available inputs:",a.map(e=>({type:e.type,used:n.has(e.type)}))),console.warn("   Used inputs:",Array.from(n)),console.warn("   This CDJ will not be connected to the mixer!")}})}return console.log("Found connections:",i),i}function pt(e){e.children=e.children.filter(e=>"environment"!==e.userData.type);const t="DJ"===ge?30:20,n=new i.bdM(t,t),o=new i.eaF(n,null);o.rotation.x=-Math.PI/2,o.receiveShadow=!0,o.userData.type="environment";const r=new i.YJl,s=new i.eaF(new i.bdM(4.5,1),new i._4j({color:2236962,side:i.$EB}));s.rotation.x=-Math.PI/2,s.position.set(0,.95,-.25),s.receiveShadow=!0,s.castShadow=!1,r.add(s);const a=new i.iNn(.1,.9,.1),c=new i._4j({color:1710618});switch([{x:-2.15,z:.2},{x:2.15,z:.2}].forEach(e=>{const t=new i.eaF(a,c);t.position.set(e.x,.5,e.z),t.receiveShadow=!0,t.castShadow=!0,r.add(t)}),r.position.set(0,0,0),r.userData.type="environment",P.current=s,ge){case"DJ":o.material=new i._4j({color:1118481,roughness:.8,metalness:.2});const t=new i.YJl,n=new i._4j({color:3355443,metalness:.7,roughness:.3}),r=new i.eaF(new i.bdM(5,1.2),n);r.rotation.x=-Math.PI/2,r.position.set(0,.9,-.25),r.receiveShadow=!0,t.add(r);const s=new i.eaF(new i.bdM(5,.9),n);s.position.set(0,.45,-.85),s.receiveShadow=!0,t.add(s);const a=n.clone(),c=new i.eaF(new i.bdM(1.2,.9),a);c.rotation.y=Math.PI/2,c.position.set(-2.5,.45,-.25),c.receiveShadow=!0,t.add(c);const l=new i.eaF(new i.bdM(1.2,.9),a);l.rotation.y=-Math.PI/2,l.position.set(2.5,.45,-.25),l.receiveShadow=!0,t.add(l),t.position.set(0,0,0),t.userData.type="environment";const d=t;[16711680,65280,255,16711935].forEach((t,n)=>{const o=new i.nCl(t,2);o.position.set(3*Math.cos(n*Math.PI/2),4,3*Math.sin(n*Math.PI/2)),o.angle=Math.PI/6,o.penumbra=.3,o.decay=1,o.distance=10,o.target.position.set(0,0,0),o.castShadow=!0,o.userData.type="environment",e.add(o),e.add(o.target)}),e.add(d);const u=new i.YJl,p=new i.bdM(12,8),g=new i._4j({color:1710618,roughness:.3,metalness:.8,side:i.$EB}),f=new i.eaF(p,g);f.rotation.x=-Math.PI/2,f.position.set(0,.01,-7),f.receiveShadow=!0,u.add(f);const h=1,m=[2763306,657930],x=12,y=8,v=-7;for(let e=0;e<x;e++)for(let t=0;t<y;t++){const n=new i.eaF(new i.bdM(h,h),new i._4j({color:m[(e+t)%2],roughness:.2,metalness:.9,side:i.$EB}));n.rotation.x=-Math.PI/2,n.position.set(e*h-6+h/2,.02,v-t*h+h/2),n.receiveShadow=!0,u.add(n)}const b=new i.bdM(12,.2),w=new i._4j({color:4473924,emissive:2236962,emissiveIntensity:.3,side:i.$EB}),C=new i.eaF(b,w);C.rotation.x=-Math.PI/2,C.position.set(0,.03,-3),u.add(C);const S=new i.eaF(b,w);S.rotation.x=-Math.PI/2,S.position.set(0,.03,-11),u.add(S);const z=new i.eaF(new i.bdM(.2,8),w);z.rotation.x=-Math.PI/2,z.position.set(-6,.03,v),u.add(z);const j=new i.eaF(new i.bdM(.2,8),w);j.rotation.x=-Math.PI/2,j.position.set(6,.03,v),u.add(j),e.add(u);const I=new i._4j({color:0,roughness:.95,metalness:0,side:i.$EB}),A=30,D=30,k=12,P=new i.eaF(new i.bdM(A,k),I);P.rotation.y=Math.PI,P.position.set(0,k/2,-D/2),P.receiveShadow=!0,e.add(P);const L=new i._4j({color:6684672,emissive:16711680,emissiveIntensity:.4,side:i.$EB}),F=-A/2+.5,M=5;for(let o=0;o<M;o++){const t=new i.eaF(new i.bdM(.12,2+o%2*1.5),L.clone());t.rotation.y=Math.PI;const n=k/2+2.5*(o-(M-1)/2);t.position.set(F,n,-D/2+.01),e.add(t)}const R=A/2-.5;for(let o=0;o<M;o++){const t=new i.eaF(new i.bdM(.12,2+o%2*1.5),L.clone());t.rotation.y=Math.PI;const n=k/2+2.5*(o-(M-1)/2);t.position.set(R,n,-D/2+.01),e.add(t)}const E=L.clone();E.emissiveIntensity=.2;const N=new i.eaF(new i.bdM(.1,3),E);N.rotation.y=Math.PI,N.rotation.z=Math.PI/4,N.position.set(F+.5,k-1,-D/2+.01),e.add(N);const T=new i.eaF(new i.bdM(.1,3),E);T.rotation.y=Math.PI,T.rotation.z=-Math.PI/4,T.position.set(R-.5,k-1,-D/2+.01),e.add(T);const q=8;for(let o=0;o<q;o++){const t=new i.nCl(16711680,.5),n=-A/2+2+o*(A-4)/(q-1);t.position.set(n,k-1,-D/2+2),t.target.position.set(n,0,-D/2+2),t.angle=Math.PI/12,t.penumbra=.2,t.decay=2,t.distance=k,t.castShadow=!1,e.add(t),e.add(t.target)}const B=new i.eaF(new i.bdM(D,k),I.clone());B.rotation.y=Math.PI/2,B.position.set(-A/2,k/2,0),B.receiveShadow=!0,e.add(B);const J=new i.eaF(new i.bdM(D,k),I.clone());J.rotation.y=-Math.PI/2,J.position.set(A/2,k/2,0),J.receiveShadow=!0,e.add(J);const O=new i.eaF(new i.bdM(A,k),I.clone());O.position.set(0,k/2,D/2),O.receiveShadow=!0,e.add(O);const U=new i.eaF(new i.bdM(A,D),I.clone());U.rotation.x=Math.PI/2,U.position.set(0,k,0),U.receiveShadow=!0,e.add(U);break;case"Producer":o.material=new i._4j({color:4473924,roughness:.9});const W=new i.iNn(.5,1,1),X=new i._4j({color:6710886});for(let o=-2;o<=2;o++){const t=new i.eaF(W,X);if(t.position.set(1.2*o,1.5,-2),t.userData.type="environment",e.add(t),o>-2&&o<2){const t=new i.eaF(W,X);t.rotation.y=Math.PI/2,t.position.set(-3,1.5,1.2*o),t.userData.type="environment",e.add(t);const n=new i.eaF(W,X);n.rotation.y=Math.PI/2,n.position.set(3,1.5,1.2*o),n.userData.type="environment",e.add(n)}}const _=new i.HiM(16777215,1);_.position.set(2,3,2),_.userData.type="environment",e.add(_);const H=new i.HiM(16777215,1);H.position.set(-2,3,-2),H.userData.type="environment",e.add(H);break;case"Musician":o.material=new i._4j({color:3351057,roughness:.8});const Y=new i.iNn(6,3,.1),V=new i.uSd({color:11184810,transparent:!0,opacity:.3,roughness:.1,metalness:.1,transmission:.5}),$=new i.eaF(Y,V);$.position.set(0,1.5,-2),$.userData.type="environment",e.add($);const G=new i.HiM(16755302,1);G.position.set(0,3,0),G.userData.type="environment",e.add(G);const K=new i.nCl(16750950,.8);K.position.set(-2,2,-1),K.angle=Math.PI/6,K.penumbra=.5,K.userData.type="environment",e.add(K);const Z=new i.nCl(16750950,.8);Z.position.set(2,2,-1),Z.angle=Math.PI/6,Z.penumbra=.5,Z.userData.type="environment",e.add(Z);break;default:o.material=new i._4j({color:8947848,roughness:.8})}e.add(o),e.add(r);const l=new i.$p8(4210752,.5);l.userData.type="environment",e.add(l)}const gt=e=>{var t;if(!Y||!Q||!$)return;e.preventDefault();const n=new i.I9Y;n.x=e.clientX/window.innerWidth*2-1,n.y=-e.clientY/window.innerHeight*2+1;const o=new i.tBo;o.setFromCamera(n,z.current);const r=null===(t=A.current[Q.id])||void 0===t?void 0:t.model;if(!r)return;const s=o.intersectObject(r,!0);if(s.length>0){const e=s[0].point,t=r.worldToLocal(e.clone());ft(Q.id,K,$,t),V(!1),G(null),Z(null),ee(null)}},ft=async function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;try{const s=(0,c.H9)(l.db,"products",e),a=await(0,c.x7)(s);if(!a.exists())return;const d=[...a.data()[t]||[]],u="number"===typeof i&&i>=0&&i<d.length?i:d.findIndex(e=>e.type===n);if(-1===u)return;const p={x:r.x,y:r.y,z:r.z};d[u]=(0,o.A)((0,o.A)({},d[u]),{},{coordinate:p,position:p}),await(0,c.mZ)(s,{[t]:d}),console.log("Updated ".concat(t," connection point at index ").concat(u))}catch(ie){console.error("Error updating connection point:",ie),alert("Failed to update connection point.")}},ht=e=>{if(null===e||void 0===e||!e.name)return!1;const t=e.name.toLowerCase();return t.includes("djm")||t.includes("900nxs2")||t.includes("900 nxs2")||t.includes("mixer")},mt=async()=>{if(null!==ke&&void 0!==ke&&ke.id&&l.db&&ht(ke))try{const e=(0,c.H9)(l.db,"products",ke.id),t=await(0,c.x7)(e);if(!t.exists())return void alert("Product not found in database.");const n=t.data(),r=n.inputs||[],i=n.outputs||[],s=i.some(e=>e.type&&e.type.toLowerCase().includes("send")),a=r.some(e=>e.type&&e.type.toLowerCase().includes("return"));if(s&&a)return void alert("Mixer already has Send and Return ports.");const d=[...r],u=[...i];s||u.push({type:"Send Out",coordinate:{x:.02,y:.075,z:-.28}}),a||d.push({type:"Return In",coordinate:{x:.06,y:.075,z:-.28}}),await(0,c.mZ)(e,{inputs:d,outputs:u});const p=(await(0,c.x7)(e)).data(),g=(0,o.A)((0,o.A)({},ke),{},{inputs:p.inputs||d,outputs:p.outputs||u});Pe(g);const f=R.current||[];R.current=f.map(e=>e.uniqueId===ke.uniqueId?g:e),de(R.current),S.current&&R.current.length>0&&Ze(R.current),alert('Send Out and Return In ports added. Open "Edit connection positions" to see and adjust them.')}catch(e){console.error("Error adding Send/Return ports:",e),alert("Failed to add ports: "+(e.message||"check console"))}};function xt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!P.current)return void console.log("Cannot create ghost spots: No DJ table reference");const n=null!==t?t:ue;console.log("Creating ghost spots with:",{setupType:ge,basicSetupComplete:n,stateBasicSetupComplete:ue}),L.current.forEach(t=>{t&&t.parent&&e.remove(t)}),L.current=[];let o=[];switch(ge){case"DJ":o=[$e[0],$e[1],$e[2],$e[3],$e[4],$e[12],$e[13]],n&&(console.log("Adding FX spots for completed DJ setup"),o=[...o,$e[8],$e[9],$e[10],$e[11]]);break;case"Producer":o=[{x:0,y:1.05,z:0,type:"interface"},{x:-.8,y:1.05,z:0,type:"synth_left"},{x:.8,y:1.05,z:0,type:"synth_right"},{x:-1.6,y:1.05,z:0,type:"fx_left"},{x:1.6,y:1.05,z:0,type:"fx_right"}];break;case"Musician":o=[{x:0,y:1.05,z:0,type:"main_instrument",size:{width:.4,depth:.4}},{x:0,y:.05,z:.5,type:"effects",size:{width:.8,depth:.3}}];break;default:o=[{x:0,y:1.05,z:0,type:"default"}]}console.log("Creating ".concat(o.length," ghost spots, including FX: ").concat(n)),o.forEach((t,n)=>{var o;const r=(null===(o=t.type)||void 0===o?void 0:o.includes("fx_"))||"effects"===t.type,s=t.size||null,a=new i.iNn(s?s.width:r?.15:.3,.05,s?s.depth:r?.15:.3),c=new i.V9B({color:8421504,transparent:!0,opacity:.4}),l=new i.eaF(a,c);l.position.set(t.x,t.y,t.z),l.userData={index:n,defaultColor:8421504,hoverColor:10526880,type:t.type,recommendedType:vt(t.type)},e.add(l),L.current.push(l),console.log("Created ghost square ".concat(n," at position:"),t)}),I.current&&z.current&&I.current.render(e,z.current)}(0,r.useEffect)(()=>{if(Y)return window.addEventListener("click",gt),()=>window.removeEventListener("click",gt)},[Y,Q,$]),(0,r.useEffect)(()=>{const e=()=>{ce(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const yt=e=>{const t=le.find(t=>t.uniqueId===e);if(t){const n=Object.values(A.current).find(t=>{var n;return(null===(n=t.data)||void 0===n?void 0:n.uniqueId)===e});null!==n&&void 0!==n&&n.model&&(S.current.remove(n.model),delete A.current[t.id]),k.current=k.current.filter(e=>e.userData.sourceDevice!==t.id&&e.userData.targetDevice!==t.id||(S.current.remove(e),!1)),St(t,"remove"),I.current&&S.current&&z.current&&I.current.render(S.current,z.current)}};(0,r.useEffect)(()=>{fe(v||"DJ")},[v]);const vt=e=>{switch(ge){case"DJ":switch(e){case Be:return"Mixer (DJM)";case Je:case Oe:case Ue:case We:return"Player (CDJ)";case Xe:case _e:case He:return"RMX-1000";case Ye:case Ve:return"Speaker";default:return"Any Device"}case"Producer":switch(e){case Be:return"Audio Interface";case Je:case Oe:return"Synthesizer";case Ue:case We:return"Effects Unit";default:return"Any Device"}case"Musician":return"Instrument or Effects";default:return"Any Device"}},bt=.01,wt=e=>({x:Number(null===e||void 0===e?void 0:e.x)||0,y:Number(null===e||void 0===e?void 0:e.y)||0,z:Number(null===e||void 0===e?void 0:e.z)||0}),Ct=(e,t,n,r)=>{if(!ke)return;const i=[...ke[e]||[]];if(t<0||t>=i.length)return;const s=(0,o.A)((0,o.A)({},i[t]),{},{coordinate:(0,o.A)({},wt(i[t].coordinate))});s.coordinate[n]=Math.round(1e3*Number(r))/1e3,i[t]=s;const a=(0,o.A)((0,o.A)({},ke),{},{[e]:i}),c=(R.current||[]).map(e=>e.uniqueId===ke.uniqueId?a:e);R.current=c,de(c),Pe(a),S.current&&c.length>0&&Ze(c),I.current&&S.current&&z.current&&I.current.render(S.current,z.current)},St=function(e){if("add"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add")){const t=(0,o.A)((0,o.A)({},e),{},{uniqueId:"".concat(e.id,"-").concat(e.position.x,"-").concat(e.position.y,"-").concat(e.position.z)});de(n=>{const o=[...n,t],r=et(o);return console.log("After adding device:",{deviceName:e.name,isBasicSetupComplete:r,currentDevices:o.map(e=>e.name)}),r!==ue&&(console.log("Basic setup status changed to: ".concat(r)),pe(r),setTimeout(()=>{S.current&&(L.current.forEach(e=>{e&&e.parent&&S.current.remove(e)}),L.current=[],console.log("Recreating ghost spots with updated basic setup status:",r),xt(S.current,r),I.current&&z.current&&I.current.render(S.current,z.current))},0)),o})}else de(t=>{const n=t.filter(t=>t.uniqueId!==e.uniqueId),o=et(n);return console.log("After removing device:",{deviceName:e.name,isBasicSetupComplete:o,currentDevices:n.map(e=>e.name)}),o!==ue&&(console.log("Basic setup status changed to: ".concat(o)),pe(o),setTimeout(()=>{S.current&&(L.current.forEach(e=>{e&&e.parent&&S.current.remove(e)}),L.current=[],console.log("Recreating ghost spots with updated basic setup status:",o),xt(S.current,o),I.current&&z.current&&I.current.render(S.current,z.current))},0)),n})},zt=e=>{const t=Ke[e];t&&(Re(e),d.os.to(z.current.position,{x:t.position.x,y:t.position.y,z:t.position.z,duration:1.5,ease:"power2.inOut",onUpdate:()=>{z.current.lookAt(t.target.x,t.target.y,t.target.z)}}),d.os.to(j.current.target,{x:t.target.x,y:t.target.y,z:t.target.z,duration:1.5,ease:"power2.inOut",onUpdate:()=>{j.current.update()}}))};(0,r.useEffect)(()=>{S.current&&oe&&(console.log("Setup type changed to:",ge),pt(S.current),I.current&&z.current&&I.current.render(S.current,z.current))},[ge,oe]),(0,r.useEffect)(()=>{if(oe&&le.length>0){console.log("Checking initial placed devices for basic setup:",le.map(e=>e.name));const e=et(le);console.log("Initial basic setup check:",{isComplete:e,currentState:ue}),e!==ue&&(console.log("Updating basic setup state on initialization"),pe(e),setTimeout(()=>{S.current&&(xt(S.current,e),I.current&&z.current&&I.current.render(S.current,z.current))},100))}},[oe,le.length]);(0,r.useEffect)(()=>{if(je)return;const e=Date.now();e-Ee<5e3||(le&&le.length>=3?(ze(!0),Ne(e),async function(e){return e&&e.length?"Add your API integration in chatGPTService.js to get connection suggestions.":""}(le).then(Ce).catch(e=>{console.error("ChatGPT API error:",e),e.message.includes("quota")||e.message.includes("429")?(Ie(!0),Ce("API quota exceeded. Please try again later or upgrade your OpenAI plan.")):Ce("Could not get connection advice. Please try again.")}).finally(()=>ze(!1))):Ce(""))},[le,je,Ee]);const jt=(e,t)=>{console.log("Toggling category ".concat(e," visibility: ").concat(t)),qe(n=>{const o=new Set(n);return t?o.delete(e):o.add(e),console.log("New hidden categories:",Array.from(o)),o})};(0,r.useEffect)(()=>{w&&w(jt)},[]),(0,r.useEffect)(()=>{if(Ae&&null!==ke&&void 0!==ke&&ke.uniqueId){const e=le.find(e=>e.uniqueId===ke.uniqueId);e&&Pe(e)}},[le]),(0,r.useEffect)(()=>{Ae&&ke&&z.current&&j.current&&(e=>{if(!z.current||!j.current||null===e||void 0===e||!e.position)return;const t=e.position,n="number"===typeof t.x?t.x:0,o="number"===typeof t.y?t.y:1,r="number"===typeof t.z?t.z:0,i=n,s=o+.15,a=r+.8;d.os.to(z.current.position,{x:i,y:s,z:a,duration:1,ease:"power2.inOut",onUpdate:()=>{z.current.lookAt(n,o,r)}}),d.os.to(j.current.target,{x:n,y:o,z:r,duration:1,ease:"power2.inOut",onUpdate:()=>{j.current.update()}})})(ke)},[Ae]),(0,r.useEffect)(()=>{S.current&&le.length>0&&(console.log("Processing devices for visibility:",le.map(e=>e.name)),console.log("Hidden categories:",Array.from(Te)),le.forEach(e=>{const t=A.current[e.uniqueId];if(t&&t.model){const n=It(e),o=Te.has(n);console.log("Device: ".concat(e.name," -> Category: ").concat(n," -> Should hide: ").concat(o)),t.model.visible=!o}else console.log("Device object not found for: ".concat(e.name," (").concat(e.uniqueId,")"))}),I.current&&z.current&&I.current.render(S.current,z.current))},[Te,le]);const It=e=>{const t=e.name.toLowerCase();return console.log('Categorizing device: "'.concat(e.name,'" -> "').concat(t,'"')),t.includes("cdj")||t.includes("turntable")||t.includes("controller")?(console.log("  -> Matched players category"),"players"):t.includes("djm")||t.includes("mixer")?(console.log("  -> Matched mixers category"),"mixers"):t.includes("rmx")||t.includes("effect")?(console.log("  -> Matched effects category"),"effects"):t.includes("speaker")||t.includes("monitor")?(console.log("  -> Matched speakers category"),"speakers"):t.includes("cable")||t.includes("rca")||t.includes("xlr")?(console.log("  -> Matched cables category"),"cables"):t.includes("headphone")||t.includes("case")?(console.log("  -> Matched accessories category"),"accessories"):(console.log("  -> Default to players category"),"players")};return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{ref:C,style:{width:"100%",height:ae?"calc(100vh - 60px)":"100%",touchAction:"none",backgroundColor:"#0a0a0a"},children:[ie&&(0,p.jsxs)("div",{className:"error-message fade-in",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(255, 82, 82, 0.9)",padding:"20px",borderRadius:"8px",textAlign:"center",color:"#ffffff",backdropFilter:"blur(8px)"},children:[(0,p.jsx)("h3",{style:{marginBottom:"12px"},children:"Error"}),(0,p.jsx)("p",{style:{marginBottom:"16px"},children:ie}),(0,p.jsx)("button",{onClick:()=>window.location.reload(),style:{backgroundColor:"rgba(255, 255, 255, 0.2)",border:"none",padding:"8px 16px",borderRadius:"4px",color:"#ffffff",cursor:"pointer"},children:"Retry"})]}),Ae&&ke&&(0,p.jsxs)("div",{className:"mini-profile-panel",style:{position:"fixed",top:0,right:0,bottom:0,width:ae?"100%":"320px",maxWidth:"100%",zIndex:900,background:"linear-gradient(180deg, #1a1a1e 0%, #121218 100%)",boxShadow:"-4px 0 24px rgba(0,0,0,0.4), inset 1px 0 0 rgba(255,255,255,0.06)",borderLeft:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,p.jsx)("div",{style:{padding:"20px 20px 16px",flexShrink:0,borderBottom:"1px solid rgba(255,255,255,0.08)"},children:(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,p.jsx)("h3",{style:{margin:0,color:"#fff",fontSize:"18px"},children:ke.name}),(0,p.jsx)("button",{type:"button","aria-label":"Close",style:{background:"none",border:"none",color:"rgba(255,255,255,0.6)",fontSize:"24px",cursor:"pointer",padding:"0 4px",lineHeight:1},onClick:()=>{De(!1),Fe(!1),Pe(null)},children:"\xd7"})]})}),(0,p.jsxs)("div",{style:{padding:"20px",overflowY:"auto",flex:1,display:"flex",flexDirection:"column",gap:"16px"},children:[(0,p.jsxs)("div",{style:{padding:"12px 14px",background:"rgba(255,255,255,0.06)",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.08)"},children:[(0,p.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,p.jsx)("span",{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.04em"},children:"Cost"}),(0,p.jsx)("div",{style:{color:"#fff",fontSize:"16px",fontWeight:600},children:"number"===typeof ke.price&&ke.price>0?"$".concat(Number(ke.price).toLocaleString()):"\u2014"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("span",{style:{color:"rgba(255,255,255,0.5)",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.04em"},children:"Purchase"}),(0,p.jsx)("div",{style:{marginTop:"4px"},children:(0,p.jsx)("button",{type:"button",style:{color:"#00a2ff",fontSize:"14px",textDecoration:"none",background:"none",border:"none",padding:0,cursor:"default",font:"inherit"},children:"Link to purchase (coming soon)"})})]})]}),Le?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("p",{style:{margin:"0 0 12px",color:"rgba(255,255,255,0.7)",fontSize:"13px"},children:"Nudge X, Y, Z so cable endpoints match the 3D model. Watch the scene update."}),!ht(ke)||(ke.outputs||[]).some(e=>e.type&&e.type.toLowerCase().includes("send"))&&(ke.inputs||[]).some(e=>e.type&&e.type.toLowerCase().includes("return"))?null:(0,p.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,p.jsx)("button",{type:"button",style:{width:"100%",padding:"10px 16px",fontSize:"13px",fontWeight:600,color:"#2ecc71",background:"rgba(46, 204, 113, 0.15)",border:"1px solid rgba(46, 204, 113, 0.4)",borderRadius:"8px",cursor:"pointer",fontFamily:"inherit"},onClick:mt,children:"Add Send & Return ports"}),(0,p.jsx)("p",{style:{margin:"8px 0 0",color:"rgba(255,255,255,0.5)",fontSize:"12px"},children:'Adds "Send Out" (output) and "Return In" (input) for FX/Revolo cables.'})]}),["inputs","outputs"].map(e=>{const t=ke[e]||[],n="inputs"===e?"Inputs":"Outputs",o=(ke.name||"").toLowerCase().includes("djm")||(ke.name||"").toLowerCase().includes("mixer");return 0===t.length?null:(0,p.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,p.jsx)("h4",{style:{margin:"0 0 8px",color:"rgba(255,255,255,0.9)",fontSize:"14px"},children:n}),(0,p.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:t.map((t,r)=>{const i=wt(t.coordinate),s={display:"flex",alignItems:"center",gap:"6px",marginTop:"4px"},a={width:"28px",height:"28px",padding:0,border:"1px solid rgba(255,255,255,0.25)",borderRadius:"4px",background:"rgba(255,255,255,0.1)",color:"#fff",cursor:"pointer",fontSize:"14px",fontFamily:"inherit"},c={width:"76px",padding:"6px 8px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"4px",color:"#fff",fontSize:"13px",textAlign:"center"},l=((t,r)=>{if(o&&"inputs"===e){const e=(t.type||"").toLowerCase();if(e.includes("return"))return"Return";if(e.match(/^line\s*(\d)$/)){const t=e.replace(/\D/g,"");return"6"===t?"Return":"Line ".concat(t)}if(e.includes("1/4")||"rca"===e||e&&!e.match(/^line\s*\d$/)&&!e.match(/^ch\s*\d$/))return r+1===6?"Return":"Line ".concat(r+1)}return t.type||"".concat(n.slice(0,-1)," ").concat(r+1)})(t,r);return(0,p.jsxs)("div",{style:{padding:"10px 12px",background:"rgba(255,255,255,0.06)",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.08)"},children:[(0,p.jsx)("div",{style:{color:"#fff",fontSize:"13px",fontWeight:500,marginBottom:"6px"},children:l}),["x","y","z"].map(t=>(0,p.jsxs)("div",{style:s,children:[(0,p.jsx)("span",{style:{width:"14px",color:"rgba(255,255,255,0.7)",fontSize:"12px",textTransform:"uppercase"},children:t}),(0,p.jsx)("button",{type:"button","aria-label":"".concat(t," minus"),style:a,onClick:()=>Ct(e,r,t,i[t]-bt),children:"\u2212"}),(0,p.jsx)("input",{type:"number",step:bt,value:i[t],style:c,onChange:n=>Ct(e,r,t,n.target.value)}),(0,p.jsx)("button",{type:"button","aria-label":"".concat(t," plus"),style:a,onClick:()=>Ct(e,r,t,i[t]+bt),children:"+"})]},t))]},r)})})]},e)}),(0,p.jsx)("button",{type:"button",style:{marginTop:"16px",width:"100%",padding:"10px",fontSize:"13px",color:"rgba(255,255,255,0.8)",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:"8px",cursor:"pointer",fontFamily:"inherit"},onClick:async()=>{let e=!1;if(null!==ke&&void 0!==ke&&ke.id){const t=e=>({x:Number(null===e||void 0===e?void 0:e.x)||0,y:Number(null===e||void 0===e?void 0:e.y)||0,z:Number(null===e||void 0===e?void 0:e.z)||0}),n=ke.inputs||[];for(let r=0;r<n.length;r++){const o=n[r];null!==o&&void 0!==o&&o.coordinate&&(await ft(ke.id,"inputs",o.type,t(o.coordinate),r),e=!0)}const o=ke.outputs||[];for(let r=0;r<o.length;r++){const n=o[r];null!==n&&void 0!==n&&n.coordinate&&(await ft(ke.id,"outputs",n.type,t(n.coordinate),r),e=!0)}}Fe(!1),e&&alert("Connection positions saved to product.")},children:"Done"})]}):(0,p.jsxs)(p.Fragment,{children:[ht(ke)&&(()=>{const e=ke.outputs||[],t=ke.inputs||[];return!e.some(e=>e.type&&e.type.toLowerCase().includes("send"))||!t.some(e=>e.type&&e.type.toLowerCase().includes("return"))?(0,p.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,p.jsx)("button",{type:"button",style:{width:"100%",padding:"12px 16px",fontSize:"14px",fontWeight:600,color:"#2ecc71",background:"rgba(46, 204, 113, 0.2)",border:"1px solid rgba(46, 204, 113, 0.5)",borderRadius:"10px",cursor:"pointer",fontFamily:"inherit"},onClick:mt,children:"Add Send & Return ports to mixer"}),(0,p.jsx)("p",{style:{margin:"8px 0 0",color:"rgba(255,255,255,0.5)",fontSize:"12px"},children:'Adds "Send Out" (output) and "Return In" (input) for FX/Revolo cables. Then use Edit connection positions below to place them.'})]}):null})(),(0,p.jsx)("p",{style:{margin:"0 0 8px",color:"rgba(255,255,255,0.6)",fontSize:"13px"},children:"Adjust where cables attach to this device (X, Y, Z). Changes appear in the scene."}),(0,p.jsx)("button",{type:"button",className:"edit-connections-btn",style:{width:"100%",padding:"12px 16px",fontSize:"14px",fontWeight:600,color:"#00a2ff",background:"rgba(0, 162, 255, 0.15)",border:"1px solid rgba(0, 162, 255, 0.4)",borderRadius:"10px",cursor:"pointer",fontFamily:"inherit",marginTop:"auto"},onClick:()=>Fe(!0),children:"Edit connection positions"})]})]})]}),ae&&(0,p.jsx)(x,{onSetView:()=>zt("set"),onConnectionsView:()=>zt("connections"),onOpenSearch:()=>{rt("hamburger")},placedDevicesList:le,onRemoveDevice:yt,isUpdatingPaths:xe,onUpdateModelPaths:async()=>{ye(!0);try{const e=await(0,u.Ij)();e.success?(alert("Successfully updated ".concat(e.updatedCount," model paths. Please refresh the page.")),nt()):alert("Failed to update model paths. Please check the console for details.")}catch(ie){console.error("Error updating model paths:",ie),alert("An error occurred while updating model paths.")}finally{ye(!1)}},style:{position:"fixed",top:"20px",right:"20px",zIndex:2e3}}),!ae&&(0,p.jsxs)("div",{className:"setup-list-box ".concat(he?"expanded":""),style:{position:"fixed",right:"max(24px, env(safe-area-inset-right))",bottom:"max(100px, env(safe-area-inset-bottom))",maxHeight:he?"70vh":"48px",overflow:"hidden",transition:"max-height 0.3s ease"},children:[(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",marginBottom:he?"12px":"0"},onClick:()=>me(!he),children:[(0,p.jsx)("h3",{children:"Current Setup"}),(0,p.jsx)("span",{style:{transform:he?"rotate(180deg)":"rotate(0)",transition:"transform 0.3s ease"},children:"\u25b2"})]}),he&&(0,p.jsxs)("div",{className:"setup-list-box-inner",style:{overflowY:"auto",maxHeight:"calc(70vh - 80px)",paddingRight:"4px"},children:[(0,p.jsxs)("div",{className:"fade-in",children:[le.map(e=>(0,p.jsxs)("div",{className:"setup-list-item",children:[(0,p.jsx)("span",{children:e.name}),(0,p.jsx)("button",{onClick:()=>yt(e.uniqueId),children:"Remove"})]},e.uniqueId)),0===le.length&&(0,p.jsx)("div",{style:{textAlign:"center",opacity:.7,padding:"12px 0"},children:"No devices added yet"})]}),(0,p.jsxs)("div",{style:{marginTop:"16px"},children:[(0,p.jsx)("h4",{style:{color:"#89CFF0",marginBottom:"8px"},children:"Connection Guide"}),le.length<3?(0,p.jsx)("div",{style:{color:"#aaa",fontStyle:"italic"},children:"Add at least 3 devices to get connection advice"}):je?(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{style:{color:"#ff6b6b",marginBottom:"8px"},children:we}),(0,p.jsx)("button",{onClick:()=>Ie(!1),style:{background:"rgba(0, 162, 255, 0.2)",border:"1px solid rgba(0, 162, 255, 0.3)",color:"#00a2ff",padding:"4px 8px",fontSize:"12px",borderRadius:"4px",cursor:"pointer"},children:"Try Again"})]}):Se?(0,p.jsx)("div",{style:{color:"#aaa",fontStyle:"italic"},children:"Loading connection advice..."}):(0,p.jsx)("div",{style:{color:"#fff",whiteSpace:"pre-wrap"},children:we})]})]})]}),!ae&&(0,p.jsxs)("div",{className:"camera-controls fade-in",style:{position:"fixed",left:"20px",top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:"10px",zIndex:1e3},children:[(0,p.jsx)("button",{type:"button",className:"camera-button ".concat("set"===Me?"camera-button-active":""),onClick:()=>zt("set"),children:"Set"}),(0,p.jsx)("button",{type:"button",className:"camera-button ".concat("connections"===Me?"camera-button-active":""),onClick:()=>zt("connections"),children:"Connections"})]}),W&&(0,p.jsxs)("div",{className:"search-modal fade-in",style:Ge,children:[(0,p.jsx)("style",{children:"\n                                .search-modal::-webkit-scrollbar {\n                                    width: 8px;\n                                    background-color: #000000;\n                                }\n                                .search-modal::-webkit-scrollbar-thumb {\n                                    background-color: #333333;\n                                    border-radius: 4px;\n                                }\n                                .search-modal::-webkit-scrollbar-track {\n                                    background-color: #000000;\n                                }\n                            "}),(0,p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,p.jsx)("h3",{style:{margin:0,color:"#ffffff",fontSize:"16px",fontFamily:"Space Grotesk, sans-serif"},children:"ghost"===_?"Add Device":"Search Products"}),(0,p.jsx)("button",{onClick:()=>{X(!1),H(""),U("")},style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#ffffff",opacity:.7,transition:"opacity 0.2s ease"},children:"\xd7"})]}),(0,p.jsx)("input",{type:"text",placeholder:"Search for a product...",value:O,onChange:e=>{var t;const n=e.target.value.toLowerCase();U(n),console.log("Filtering products with query:",n),console.log("Available products:",B);const o=B.filter(e=>{var t,o,r;const i=null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(n),s=null===(o=e.category)||void 0===o?void 0:o.toLowerCase().includes(n),a=null===(r=e.description)||void 0===r?void 0:r.toLowerCase().includes(n);return i||s||a}),r=L.current[T],i=null===r||void 0===r||null===(t=r.userData)||void 0===t?void 0:t.recommendedType,s=o.sort((e,t)=>{const n=ot(e,i),o=ot(t,i);return n&&!o?-1:!n&&o?1:0});console.log("Filtered and sorted results:",s),ne(s)},className:"fade-in",style:{width:"100%",padding:"12px",backgroundColor:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",color:"#ffffff",marginBottom:"20px",outline:"none"}}),ve?(0,p.jsx)(h,{onClose:()=>{be(!1)},recommendedType:(null===(t=L.current[T])||void 0===t||null===(n=t.userData)||void 0===n?void 0:n.recommendedType)||"Any Device",spotType:(null===(g=L.current[T])||void 0===g||null===(f=g.userData)||void 0===f?void 0:f.type)||"standard"}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("button",{onClick:()=>{be(!0)},style:{width:"100%",padding:"12px",backgroundColor:"rgba(46, 204, 113, 0.2)",border:"1px solid rgba(46, 204, 113, 0.3)",borderRadius:"4px",color:"#2ecc71",marginBottom:"20px",cursor:"pointer",transition:"all 0.2s ease",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[(0,p.jsx)("span",{children:"+"})," Suggest New Product"]}),(0,p.jsxs)("div",{className:"search-results fade-in",style:{maxHeight:"400px",overflowY:"auto"},children:[te.map(e=>{var t;const n=L.current[T],r=null===n||void 0===n||null===(t=n.userData)||void 0===t?void 0:t.recommendedType,i=ot(e,r);return(0,p.jsxs)("div",{onClick:()=>(async e=>{if(!e)return;let t=e;if(e.id&&l.db)try{const n=(0,c.H9)(l.db,"products",e.id),r=await(0,c.x7)(n);r.exists()&&(t=(0,o.A)({id:r.id},r.data()))}catch(n){console.warn("Could not fetch latest product, using cached:",n)}console.log("Adding selected product: ".concat(t.name," to position ").concat(T)),tt(t,T),X(!1),H(""),U("")})(e),style:{padding:"12px",marginBottom:i?"8px":"0",cursor:"pointer",transition:"all 0.2s ease",backgroundColor:i?"rgba(39, 174, 96, 0.1)":"transparent",boxShadow:i?"0 0 15px rgba(39, 174, 96, 0.2)":"none",borderRadius:i?"4px":"0",border:i?"1px solid rgba(39, 174, 96, 0.3)":"1px solid rgba(255, 255, 255, 0.1)",position:"relative"},children:[(0,p.jsxs)("div",{style:{fontWeight:"500",color:i?"#2ecc71":"#ffffff",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.name,i&&(0,p.jsx)("span",{style:{fontSize:"12px",padding:"2px 6px",backgroundColor:"rgba(46, 204, 113, 0.2)",borderRadius:"4px",marginLeft:"8px"},children:"Recommended"})]}),(0,p.jsx)("div",{style:{fontSize:"12px",opacity:.7,marginTop:"4px",color:i?"#2ecc71":"#ffffff"},children:e.category})]},e.id)}),0===te.length&&(0,p.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"rgba(255, 255, 255, 0.5)"},children:"No products found"})]})]})]})]})})}const v=y}}]);